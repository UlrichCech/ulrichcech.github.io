<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>jmm-article-part1.md</title>
    <style>@import 'https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.2.0/katex.min.css';

    code {
        color: #c7254e;
        background-color: #f9f2f4;
        border-radius: 4px
    }

    code, kbd {
        padding: 2px 4px
    }

    kbd {
        color: #fff;
        background-color: #333;
        border-radius: 3px;
        box-shadow: inset 0 -1px 0 rgba(0, 0, 0, .25)
    }

    kbd kbd {
        padding: 0;
        font-size: 100%;
        box-shadow: none
    }

    pre {
        display: block;
        margin: 0 0 10px;
        word-break: break-all;
        word-wrap: break-word;
        color: #333;
        background-color: #f5f5f5;
        border: 1px solid #ccc;
        border-radius: 4px
    }

    pre code {
        padding: 0;
        font-size: inherit;
        color: inherit;
        white-space: pre-wrap;
        background-color: transparent;
        border-radius: 0
    }

    .pre-scrollable {
        max-height: 340px;
        overflow-y: scroll
    }

    table {
        background-color: transparent
    }

    th {
        text-align: left
    }

    .table {
        width: 100%;
        max-width: 100%;
        margin-bottom: 20px
    }

    .table > thead > tr > th {
        padding: 8px;
        line-height: 1.4285714;
        border-top: 1px solid #ddd
    }

    .table > thead > tr > td, .table > tbody > tr > th, .table > tbody > tr > td, .table > tfoot > tr > th, .table > tfoot > tr > td {
        padding: 8px;
        line-height: 1.4285714;
        vertical-align: top;
        border-top: 1px solid #ddd
    }

    .table > thead > tr > th {
        vertical-align: bottom;
        border-bottom: 2px solid #ddd
    }

    .table > caption + thead > tr:first-child > th, .table > caption + thead > tr:first-child > td, .table > colgroup + thead > tr:first-child > th, .table > colgroup + thead > tr:first-child > td, .table > thead:first-child > tr:first-child > th, .table > thead:first-child > tr:first-child > td {
        border-top: 0
    }

    .table > tbody + tbody {
        border-top: 2px solid #ddd
    }

    .table .table {
        background-color: #fff
    }

    .table-condensed > thead > tr > th, .table-condensed > thead > tr > td, .table-condensed > tbody > tr > th, .table-condensed > tbody > tr > td, .table-condensed > tfoot > tr > th, .table-condensed > tfoot > tr > td {
        padding: 5px
    }

    .table-bordered, .table-bordered > thead > tr > th, .table-bordered > thead > tr > td, .table-bordered > tbody > tr > th, .table-bordered > tbody > tr > td, .table-bordered > tfoot > tr > th, .table-bordered > tfoot > tr > td {
        border: 1px solid #ddd
    }

    .table-bordered > thead > tr > th, .table-bordered > thead > tr > td {
        border-bottom-width: 2px
    }

    .table-striped > tbody > tr:nth-child(odd) > td, .table-striped > tbody > tr:nth-child(odd) > th {
        background-color: #f9f9f9
    }

    .table-hover > tbody > tr:hover > td, .table-hover > tbody > tr:hover > th {
        background-color: #f5f5f5
    }

    table col[class*="col-"] {
        position: static;
        float: none;
        display: table-column
    }

    table td[class*="col-"], table th[class*="col-"] {
        position: static;
        float: none;
        display: table-cell
    }

    .table > thead > tr > td.active, .table > thead > tr > th.active, .table > thead > tr.active > td, .table > thead > tr.active > th, .table > tbody > tr > td.active, .table > tbody > tr > th.active, .table > tbody > tr.active > td, .table > tbody > tr.active > th, .table > tfoot > tr > td.active, .table > tfoot > tr > th.active, .table > tfoot > tr.active > td, .table > tfoot > tr.active > th {
        background-color: #f5f5f5
    }

    .table-hover > tbody > tr > td.active:hover, .table-hover > tbody > tr > th.active:hover, .table-hover > tbody > tr.active:hover > td, .table-hover > tbody > tr:hover > .active, .table-hover > tbody > tr.active:hover > th {
        background-color: #e8e8e8
    }

    .table > thead > tr > td.success, .table > thead > tr > th.success, .table > thead > tr.success > td, .table > thead > tr.success > th, .table > tbody > tr > td.success, .table > tbody > tr > th.success, .table > tbody > tr.success > td, .table > tbody > tr.success > th, .table > tfoot > tr > td.success, .table > tfoot > tr > th.success, .table > tfoot > tr.success > td, .table > tfoot > tr.success > th {
        background-color: #dff0d8
    }

    .table-hover > tbody > tr > td.success:hover, .table-hover > tbody > tr > th.success:hover, .table-hover > tbody > tr.success:hover > td, .table-hover > tbody > tr:hover > .success, .table-hover > tbody > tr.success:hover > th {
        background-color: #d0e9c6
    }

    .table > thead > tr > td.info, .table > thead > tr > th.info, .table > thead > tr.info > td, .table > thead > tr.info > th, .table > tbody > tr > td.info, .table > tbody > tr > th.info, .table > tbody > tr.info > td, .table > tbody > tr.info > th, .table > tfoot > tr > td.info, .table > tfoot > tr > th.info, .table > tfoot > tr.info > td, .table > tfoot > tr.info > th {
        background-color: #d9edf7
    }

    .table-hover > tbody > tr > td.info:hover, .table-hover > tbody > tr > th.info:hover, .table-hover > tbody > tr.info:hover > td, .table-hover > tbody > tr:hover > .info, .table-hover > tbody > tr.info:hover > th {
        background-color: #c4e3f3
    }

    .table > thead > tr > td.warning, .table > thead > tr > th.warning, .table > thead > tr.warning > td, .table > thead > tr.warning > th, .table > tbody > tr > td.warning, .table > tbody > tr > th.warning, .table > tbody > tr.warning > td, .table > tbody > tr.warning > th, .table > tfoot > tr > td.warning, .table > tfoot > tr > th.warning, .table > tfoot > tr.warning > td, .table > tfoot > tr.warning > th {
        background-color: #fcf8e3
    }

    .table-hover > tbody > tr > td.warning:hover, .table-hover > tbody > tr > th.warning:hover, .table-hover > tbody > tr.warning:hover > td, .table-hover > tbody > tr:hover > .warning, .table-hover > tbody > tr.warning:hover > th {
        background-color: #faf2cc
    }

    .table > thead > tr > td.danger, .table > thead > tr > th.danger, .table > thead > tr.danger > td, .table > thead > tr.danger > th, .table > tbody > tr > td.danger, .table > tbody > tr > th.danger, .table > tbody > tr.danger > td, .table > tbody > tr.danger > th, .table > tfoot > tr > td.danger, .table > tfoot > tr > th.danger, .table > tfoot > tr.danger > td, .table > tfoot > tr.danger > th {
        background-color: #f2dede
    }

    .table-hover > tbody > tr > td.danger:hover, .table-hover > tbody > tr > th.danger:hover, .table-hover > tbody > tr.danger:hover > td, .table-hover > tbody > tr:hover > .danger, .table-hover > tbody > tr.danger:hover > th {
        background-color: #ebcccc
    }

    fieldset {
        border: 0;
        min-width: 0
    }

    legend {
        display: block;
        width: 100%;
        margin-bottom: 20px;
        font-size: 21px;
        line-height: inherit;
        color: #333;
        border-bottom: 1px solid #e5e5e5
    }

    label {
        display: inline-block;
        max-width: 100%;
        margin-bottom: 5px;
        font-weight: 700
    }

    input[type="radio"], input[type="checkbox"] {
        margin: 4px 0 0;
        margin-top: 1px \9;
        line-height: normal
    }

    input[type="file"] {
        display: block
    }

    input[type="range"] {
        display: block;
        width: 100%
    }

    select[multiple], select[size] {
        height: auto
    }

    input[type="file"]:focus, input[type="radio"]:focus, input[type="checkbox"]:focus {
        outline: thin dotted;
        outline: 5px auto -webkit-focus-ring-color;
        outline-offset: -2px
    }

    output {
        padding-top: 7px
    }

    output, .form-control {
        display: block;
        font-size: 14px;
        line-height: 1.4285714;
        color: #555
    }

    .form-control {
        width: 100%;
        height: 34px;
        padding: 6px 12px;
        background-color: #fff;
        background-image: none;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-shadow: inset 0 1px 1px rgba(0, 0, 0, .075);
        -webkit-transition: border-color ease-in-out .15s, box-shadow ease-in-out .15s;
        transition: border-color ease-in-out .15s, box-shadow ease-in-out .15s
    }

    .form-control:focus {
        border-color: #66afe9;
        outline: 0;
        box-shadow: inset 0 1px 1px rgba(0, 0, 0, .075), 0 0 8px rgba(102, 175, 233, .6)
    }

    .form-control::-moz-placeholder {
        color: #777;
        opacity: 1
    }

    .form-control:-ms-input-placeholder {
        color: #777
    }

    .form-control::-webkit-input-placeholder {
        color: #777
    }

    .form-control[disabled], .form-control[readonly], fieldset[disabled] .form-control {
        cursor: not-allowed;
        background-color: #eee;
        opacity: 1
    }

    textarea.form-control {
        height: auto
    }

    input[type="date"], input[type="time"], input[type="datetime-local"], input[type="month"] {
        line-height: 34px;
        line-height: 1.4285714 \0
    }

    input[type="date"].input-sm, .form-horizontal .form-group-sm input[type="date"].form-control, .input-group-sm > input[type="date"].form-control, .input-group-sm > input[type="date"].input-group-addon, .input-group-sm > .input-group-btn > input[type="date"].btn, input[type="time"].input-sm, .form-horizontal .form-group-sm input[type="time"].form-control, .input-group-sm > input[type="time"].form-control, .input-group-sm > input[type="time"].input-group-addon, .input-group-sm > .input-group-btn > input[type="time"].btn, input[type="datetime-local"].input-sm, .form-horizontal .form-group-sm input[type="datetime-local"].form-control, .input-group-sm > input[type="datetime-local"].form-control, .input-group-sm > input[type="datetime-local"].input-group-addon, .input-group-sm > .input-group-btn > input[type="datetime-local"].btn, input[type="month"].input-sm, .form-horizontal .form-group-sm input[type="month"].form-control, .input-group-sm > input[type="month"].form-control, .input-group-sm > input[type="month"].input-group-addon, .input-group-sm > .input-group-btn > input[type="month"].btn {
        line-height: 30px
    }

    input[type="date"].input-lg, .form-horizontal .form-group-lg input[type="date"].form-control, .input-group-lg > input[type="date"].form-control, .input-group-lg > input[type="date"].input-group-addon, .input-group-lg > .input-group-btn > input[type="date"].btn, input[type="time"].input-lg, .form-horizontal .form-group-lg input[type="time"].form-control, .input-group-lg > input[type="time"].form-control, .input-group-lg > input[type="time"].input-group-addon, .input-group-lg > .input-group-btn > input[type="time"].btn, input[type="datetime-local"].input-lg, .form-horizontal .form-group-lg input[type="datetime-local"].form-control, .input-group-lg > input[type="datetime-local"].form-control, .input-group-lg > input[type="datetime-local"].input-group-addon, .input-group-lg > .input-group-btn > input[type="datetime-local"].btn, input[type="month"].input-lg, .form-horizontal .form-group-lg input[type="month"].form-control, .input-group-lg > input[type="month"].form-control, .input-group-lg > input[type="month"].input-group-addon, .input-group-lg > .input-group-btn > input[type="month"].btn {
        line-height: 46px
    }

    .form-group {
        margin-bottom: 15px
    }

    .radio, .checkbox {
        position: relative;
        display: block;
        min-height: 20px;
        margin-top: 10px;
        margin-bottom: 10px
    }

    .radio label, .checkbox label {
        padding-left: 20px;
        margin-bottom: 0;
        font-weight: 400;
        cursor: pointer
    }

    .radio input[type="radio"], .radio-inline input[type="radio"], .checkbox input[type="checkbox"], .checkbox-inline input[type="checkbox"] {
        position: absolute;
        margin-left: -20px;
        margin-top: 4px \9
    }

    .radio + .radio, .checkbox + .checkbox {
        margin-top: -5px
    }

    .radio-inline, .checkbox-inline {
        display: inline-block;
        padding-left: 20px;
        margin-bottom: 0;
        vertical-align: middle;
        font-weight: 400;
        cursor: pointer
    }

    .radio-inline + .radio-inline, .checkbox-inline + .checkbox-inline {
        margin-top: 0;
        margin-left: 10px
    }

    input[type="radio"][disabled], input[type="radio"].disabled, fieldset[disabled] input[type="radio"], input[type="checkbox"][disabled], input[type="checkbox"].disabled, fieldset[disabled] input[type="checkbox"], .radio-inline.disabled, fieldset[disabled] .radio-inline, .checkbox-inline.disabled, fieldset[disabled] .checkbox-inline, .radio.disabled label, fieldset[disabled] .radio label, .checkbox.disabled label, fieldset[disabled] .checkbox label {
        cursor: not-allowed
    }

    .form-control-static {
        padding-top: 7px;
        padding-bottom: 7px;
        margin-bottom: 0
    }

    .form-control-static.input-lg, .form-horizontal .form-group-lg .form-control-static.form-control, .input-group-lg > .form-control-static.form-control, .input-group-lg > .form-control-static.input-group-addon, .input-group-lg > .input-group-btn > .form-control-static.btn, .form-control-static.input-sm, .form-horizontal .form-group-sm .form-control-static.form-control, .input-group-sm > .form-control-static.form-control, .input-group-sm > .form-control-static.input-group-addon, .input-group-sm > .input-group-btn > .form-control-static.btn {
        padding-left: 0;
        padding-right: 0
    }

    .input-sm, .form-horizontal .form-group-sm .form-control, .input-group-sm > .form-control {
        height: 30px;
        padding: 5px 10px;
        font-size: 12px;
        line-height: 1.5;
        border-radius: 3px
    }

    .input-group-sm > .input-group-addon {
        height: 30px;
        line-height: 1.5
    }

    .input-group-sm > .input-group-btn > .btn {
        height: 30px;
        padding: 5px 10px;
        font-size: 12px;
        line-height: 1.5;
        border-radius: 3px
    }

    select.input-sm, .form-horizontal .form-group-sm select.form-control, .input-group-sm > select.form-control, .input-group-sm > select.input-group-addon, .input-group-sm > .input-group-btn > select.btn {
        height: 30px;
        line-height: 30px
    }

    textarea.input-sm, .form-horizontal .form-group-sm textarea.form-control, .input-group-sm > textarea.form-control, .input-group-sm > textarea.input-group-addon, .input-group-sm > .input-group-btn > textarea.btn, select[multiple].input-sm, .form-horizontal .form-group-sm select[multiple].form-control, .input-group-sm > select[multiple].form-control, .input-group-sm > select[multiple].input-group-addon, .input-group-sm > .input-group-btn > select[multiple].btn {
        height: auto
    }

    .input-lg, .form-horizontal .form-group-lg .form-control, .input-group-lg > .form-control {
        height: 46px;
        padding: 10px 16px;
        font-size: 18px;
        line-height: 1.33;
        border-radius: 6px
    }

    .input-group-lg > .input-group-addon {
        height: 46px;
        line-height: 1.33
    }

    .input-group-lg > .input-group-btn > .btn {
        height: 46px;
        padding: 10px 16px;
        font-size: 18px;
        line-height: 1.33;
        border-radius: 6px
    }

    select.input-lg, .form-horizontal .form-group-lg select.form-control, .input-group-lg > select.form-control, .input-group-lg > select.input-group-addon, .input-group-lg > .input-group-btn > select.btn {
        height: 46px;
        line-height: 46px
    }

    textarea.input-lg, .form-horizontal .form-group-lg textarea.form-control, .input-group-lg > textarea.form-control, .input-group-lg > textarea.input-group-addon, .input-group-lg > .input-group-btn > textarea.btn, select[multiple].input-lg, .form-horizontal .form-group-lg select[multiple].form-control, .input-group-lg > select[multiple].form-control, .input-group-lg > select[multiple].input-group-addon, .input-group-lg > .input-group-btn > select[multiple].btn {
        height: auto
    }

    .has-feedback {
        position: relative
    }

    .has-feedback .form-control {
        padding-right: 42.5px
    }

    .form-control-feedback {
        position: absolute;
        top: 25px;
        right: 0;
        z-index: 2;
        display: block;
        width: 34px;
        height: 34px;
        line-height: 34px;
        text-align: center
    }

    .input-lg + .form-control-feedback, .form-horizontal .form-group-lg .form-control + .form-control-feedback, .input-group-lg > .form-control + .form-control-feedback, .input-group-lg > .input-group-addon + .form-control-feedback, .input-group-lg > .input-group-btn > .btn + .form-control-feedback {
        width: 46px;
        height: 46px;
        line-height: 46px
    }

    .input-sm + .form-control-feedback, .form-horizontal .form-group-sm .form-control + .form-control-feedback, .input-group-sm > .form-control + .form-control-feedback, .input-group-sm > .input-group-addon + .form-control-feedback, .input-group-sm > .input-group-btn > .btn + .form-control-feedback {
        width: 30px;
        height: 30px;
        line-height: 30px
    }

    .has-success .help-block, .has-success .control-label, .has-success .radio, .has-success .checkbox, .has-success .radio-inline, .has-success .checkbox-inline {
        color: #3c763d
    }

    .has-success .form-control {
        border-color: #3c763d;
        box-shadow: inset 0 1px 1px rgba(0, 0, 0, .075)
    }

    .has-success .form-control:focus {
        border-color: #2b542c;
        box-shadow: inset 0 1px 1px rgba(0, 0, 0, .075), 0 0 6px #67b168
    }

    .has-success .input-group-addon {
        color: #3c763d;
        border-color: #3c763d;
        background-color: #dff0d8
    }

    .has-success .form-control-feedback {
        color: #3c763d
    }

    .has-warning .help-block, .has-warning .control-label, .has-warning .radio, .has-warning .checkbox, .has-warning .radio-inline, .has-warning .checkbox-inline {
        color: #8a6d3b
    }

    .has-warning .form-control {
        border-color: #8a6d3b;
        box-shadow: inset 0 1px 1px rgba(0, 0, 0, .075)
    }

    .has-warning .form-control:focus {
        border-color: #66512c;
        box-shadow: inset 0 1px 1px rgba(0, 0, 0, .075), 0 0 6px #c0a16b
    }

    .has-warning .input-group-addon {
        color: #8a6d3b;
        border-color: #8a6d3b;
        background-color: #fcf8e3
    }

    .has-warning .form-control-feedback {
        color: #8a6d3b
    }

    .has-error .help-block, .has-error .control-label, .has-error .radio, .has-error .checkbox, .has-error .radio-inline, .has-error .checkbox-inline {
        color: #a94442
    }

    .has-error .form-control {
        border-color: #a94442;
        box-shadow: inset 0 1px 1px rgba(0, 0, 0, .075)
    }

    .has-error .form-control:focus {
        border-color: #843534;
        box-shadow: inset 0 1px 1px rgba(0, 0, 0, .075), 0 0 6px #ce8483
    }

    .has-error .input-group-addon {
        color: #a94442;
        border-color: #a94442;
        background-color: #f2dede
    }

    .has-error .form-control-feedback {
        color: #a94442
    }

    .has-feedback label.sr-only ~ .form-control-feedback {
        top: 0
    }

    .help-block {
        display: block;
        margin-top: 5px;
        margin-bottom: 10px;
        color: #737373
    }

    .form-horizontal .radio, .form-horizontal .checkbox, .form-horizontal .radio-inline, .form-horizontal .checkbox-inline {
        margin-top: 0;
        margin-bottom: 0;
        padding-top: 7px
    }

    .form-horizontal .radio, .form-horizontal .checkbox {
        min-height: 27px
    }

    .form-horizontal .form-group {
        margin-left: -15px;
        margin-right: -15px
    }

    .form-horizontal .form-group:before {
        content: " ";
        display: table
    }

    .form-horizontal .form-group:after {
        content: " ";
        display: table;
        clear: both
    }

    .form-horizontal .has-feedback .form-control-feedback {
        top: 0;
        right: 15px
    }

    .btn {
        display: inline-block;
        vertical-align: middle;
        cursor: pointer;
        background-image: none;
        border: 1px solid transparent;
        white-space: nowrap;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none
    }

    .btn:focus, .btn:active:focus, .btn.active:focus {
        outline: thin dotted;
        outline: 5px auto -webkit-focus-ring-color;
        outline-offset: -2px
    }

    .btn:hover, .btn:focus {
        color: #333;
        text-decoration: none
    }

    .btn:active, .btn.active {
        outline: 0;
        background-image: none;
        box-shadow: inset 0 3px 5px rgba(0, 0, 0, .125)
    }

    .btn.disabled, .btn[disabled], fieldset[disabled] .btn {
        cursor: not-allowed;
        pointer-events: none;
        opacity: .65;
        filter: alpha(opacity=65);
        box-shadow: none
    }

    .btn-default {
        color: #333;
        background-color: #fff;
        border-color: #ccc
    }

    .btn-default:hover, .btn-default:focus, .btn-default:active, .btn-default.active, .open > .btn-default.dropdown-toggle {
        color: #333;
        background-color: #e6e6e6;
        border-color: #adadad
    }

    .btn-default:active, .btn-default.active, .open > .btn-default.dropdown-toggle {
        background-image: none
    }

    .btn-default.disabled, .btn-default.disabled:hover, .btn-default.disabled:focus, .btn-default.disabled:active, .btn-default.disabled.active, .btn-default[disabled], .btn-default[disabled]:hover, .btn-default[disabled]:focus, .btn-default[disabled]:active, .btn-default[disabled].active, fieldset[disabled] .btn-default, fieldset[disabled] .btn-default:hover, fieldset[disabled] .btn-default:focus, fieldset[disabled] .btn-default:active, fieldset[disabled] .btn-default.active {
        background-color: #fff;
        border-color: #ccc
    }

    .btn-default .badge {
        color: #fff;
        background-color: #333
    }

    .btn-primary {
        color: #fff;
        background-color: #428bca;
        border-color: #357ebd
    }

    .btn-primary:hover, .btn-primary:focus, .btn-primary:active, .btn-primary.active, .open > .btn-primary.dropdown-toggle {
        color: #fff;
        background-color: #3071a9;
        border-color: #285e8e
    }

    .btn-primary:active, .btn-primary.active, .open > .btn-primary.dropdown-toggle {
        background-image: none
    }

    .btn-primary.disabled, .btn-primary.disabled:hover, .btn-primary.disabled:focus, .btn-primary.disabled:active, .btn-primary.disabled.active, .btn-primary[disabled], .btn-primary[disabled]:hover, .btn-primary[disabled]:focus, .btn-primary[disabled]:active, .btn-primary[disabled].active, fieldset[disabled] .btn-primary, fieldset[disabled] .btn-primary:hover, fieldset[disabled] .btn-primary:focus, fieldset[disabled] .btn-primary:active, fieldset[disabled] .btn-primary.active {
        background-color: #428bca;
        border-color: #357ebd
    }

    .btn-primary .badge {
        color: #428bca;
        background-color: #fff
    }

    .btn-success {
        color: #fff;
        background-color: #5cb85c;
        border-color: #4cae4c
    }

    .btn-success:hover, .btn-success:focus, .btn-success:active, .btn-success.active, .open > .btn-success.dropdown-toggle {
        color: #fff;
        background-color: #449d44;
        border-color: #398439
    }

    .btn-success:active, .btn-success.active, .open > .btn-success.dropdown-toggle {
        background-image: none
    }

    .btn-success.disabled, .btn-success.disabled:hover, .btn-success.disabled:focus, .btn-success.disabled:active, .btn-success.disabled.active, .btn-success[disabled], .btn-success[disabled]:hover, .btn-success[disabled]:focus, .btn-success[disabled]:active, .btn-success[disabled].active, fieldset[disabled] .btn-success, fieldset[disabled] .btn-success:hover, fieldset[disabled] .btn-success:focus, fieldset[disabled] .btn-success:active, fieldset[disabled] .btn-success.active {
        background-color: #5cb85c;
        border-color: #4cae4c
    }

    .btn-success .badge {
        color: #5cb85c;
        background-color: #fff
    }

    .btn-info {
        color: #fff;
        background-color: #5bc0de;
        border-color: #46b8da
    }

    .btn-info:hover, .btn-info:focus, .btn-info:active, .btn-info.active, .open > .btn-info.dropdown-toggle {
        color: #fff;
        background-color: #31b0d5;
        border-color: #269abc
    }

    .btn-info:active, .btn-info.active, .open > .btn-info.dropdown-toggle {
        background-image: none
    }

    .btn-info.disabled, .btn-info.disabled:hover, .btn-info.disabled:focus, .btn-info.disabled:active, .btn-info.disabled.active, .btn-info[disabled], .btn-info[disabled]:hover, .btn-info[disabled]:focus, .btn-info[disabled]:active, .btn-info[disabled].active, fieldset[disabled] .btn-info, fieldset[disabled] .btn-info:hover, fieldset[disabled] .btn-info:focus, fieldset[disabled] .btn-info:active, fieldset[disabled] .btn-info.active {
        background-color: #5bc0de;
        border-color: #46b8da
    }

    .btn-info .badge {
        color: #5bc0de;
        background-color: #fff
    }

    .btn-warning {
        color: #fff;
        background-color: #f0ad4e;
        border-color: #eea236
    }

    .btn-warning:hover, .btn-warning:focus, .btn-warning:active, .btn-warning.active, .open > .btn-warning.dropdown-toggle {
        color: #fff;
        background-color: #ec971f;
        border-color: #d58512
    }

    .btn-warning:active, .btn-warning.active, .open > .btn-warning.dropdown-toggle {
        background-image: none
    }

    .btn-warning.disabled, .btn-warning.disabled:hover, .btn-warning.disabled:focus, .btn-warning.disabled:active, .btn-warning.disabled.active, .btn-warning[disabled], .btn-warning[disabled]:hover, .btn-warning[disabled]:focus, .btn-warning[disabled]:active, .btn-warning[disabled].active, fieldset[disabled] .btn-warning, fieldset[disabled] .btn-warning:hover, fieldset[disabled] .btn-warning:focus, fieldset[disabled] .btn-warning:active, fieldset[disabled] .btn-warning.active {
        background-color: #f0ad4e;
        border-color: #eea236
    }

    .btn-warning .badge {
        color: #f0ad4e;
        background-color: #fff
    }

    .btn-danger {
        color: #fff;
        background-color: #d9534f;
        border-color: #d43f3a
    }

    .btn-danger:hover, .btn-danger:focus, .btn-danger:active, .btn-danger.active, .open > .btn-danger.dropdown-toggle {
        color: #fff;
        background-color: #c9302c;
        border-color: #ac2925
    }

    .btn-danger:active, .btn-danger.active, .open > .btn-danger.dropdown-toggle {
        background-image: none
    }

    .btn-danger.disabled, .btn-danger.disabled:hover, .btn-danger.disabled:focus, .btn-danger.disabled:active, .btn-danger.disabled.active, .btn-danger[disabled], .btn-danger[disabled]:hover, .btn-danger[disabled]:focus, .btn-danger[disabled]:active, .btn-danger[disabled].active, fieldset[disabled] .btn-danger, fieldset[disabled] .btn-danger:hover, fieldset[disabled] .btn-danger:focus, fieldset[disabled] .btn-danger:active, fieldset[disabled] .btn-danger.active {
        background-color: #d9534f;
        border-color: #d43f3a
    }

    .btn-danger .badge {
        color: #d9534f;
        background-color: #fff
    }

    .btn-link {
        color: #428bca;
        font-weight: 400;
        cursor: pointer;
        border-radius: 0
    }

    .btn-link, .btn-link:active, .btn-link[disabled], fieldset[disabled] .btn-link {
        background-color: transparent;
        box-shadow: none
    }

    .btn-link, .btn-link:hover, .btn-link:focus, .btn-link:active {
        border-color: transparent
    }

    .btn-link:hover, .btn-link:focus {
        color: #2a6496;
        text-decoration: underline;
        background-color: transparent
    }

    .btn-link[disabled]:hover, .btn-link[disabled]:focus, fieldset[disabled] .btn-link:hover, fieldset[disabled] .btn-link:focus {
        color: #777;
        text-decoration: none
    }

    .btn-lg {
        padding: 10px 16px;
        font-size: 18px;
        line-height: 1.33;
        border-radius: 6px
    }

    .btn-sm {
        padding: 5px 10px
    }

    .btn-sm, .btn-xs {
        font-size: 12px;
        line-height: 1.5;
        border-radius: 3px
    }

    .btn-xs {
        padding: 1px 5px
    }

    .btn-block {
        display: block;
        width: 100%
    }

    .btn-block + .btn-block {
        margin-top: 5px
    }

    input[type="submit"].btn-block, input[type="reset"].btn-block, input[type="button"].btn-block {
        width: 100%
    }

    .fade {
        opacity: 0;
        -webkit-transition: opacity .15s linear;
        transition: opacity .15s linear
    }

    .fade.in {
        opacity: 1
    }

    .collapse {
        display: none
    }

    .collapse.in {
        display: block
    }

    tr.collapse.in {
        display: table-row
    }

    tbody.collapse.in {
        display: table-row-group
    }

    .collapsing {
        position: relative;
        height: 0;
        overflow: hidden;
        -webkit-transition: height .35s ease;
        transition: height .35s ease
    }

    .input-group {
        position: relative;
        display: table;
        border-collapse: separate
    }

    .input-group[class*="col-"] {
        float: none;
        padding-left: 0;
        padding-right: 0
    }

    .input-group .form-control {
        position: relative;
        z-index: 2;
        float: left;
        width: 100%;
        margin-bottom: 0
    }

    .input-group-addon, .input-group-btn, .input-group .form-control {
        display: table-cell
    }

    .input-group-addon:not(:first-child):not(:last-child), .input-group-btn:not(:first-child):not(:last-child), .input-group .form-control:not(:first-child):not(:last-child) {
        border-radius: 0
    }

    .input-group-addon {
        white-space: nowrap
    }

    .input-group-addon, .input-group-btn {
        width: 1%;
        vertical-align: middle
    }

    .input-group-addon {
        padding: 6px 12px;
        font-size: 14px;
        font-weight: 400;
        line-height: 1;
        color: #555;
        text-align: center;
        background-color: #eee;
        border: 1px solid #ccc;
        border-radius: 4px
    }

    .input-group-addon.input-sm, .form-horizontal .form-group-sm .input-group-addon.form-control, .input-group-sm > .input-group-addon, .input-group-sm > .input-group-btn > .input-group-addon.btn {
        padding: 5px 10px;
        font-size: 12px;
        border-radius: 3px
    }

    .input-group-addon.input-lg, .form-horizontal .form-group-lg .input-group-addon.form-control, .input-group-lg > .input-group-addon, .input-group-lg > .input-group-btn > .input-group-addon.btn {
        padding: 10px 16px;
        font-size: 18px;
        border-radius: 6px
    }

    .input-group-addon input[type="radio"], .input-group-addon input[type="checkbox"] {
        margin-top: 0
    }

    .input-group .form-control:first-child, .input-group-addon:first-child, .input-group-btn:first-child > .btn, .input-group-btn:first-child > .btn-group > .btn, .input-group-btn:first-child > .dropdown-toggle, .input-group-btn:last-child > .btn:not(:last-child):not(.dropdown-toggle), .input-group-btn:last-child > .btn-group:not(:last-child) > .btn {
        border-bottom-right-radius: 0;
        border-top-right-radius: 0
    }

    .input-group-addon:first-child {
        border-right: 0
    }

    .input-group .form-control:last-child, .input-group-addon:last-child, .input-group-btn:last-child > .btn, .input-group-btn:last-child > .btn-group > .btn, .input-group-btn:last-child > .dropdown-toggle, .input-group-btn:first-child > .btn:not(:first-child), .input-group-btn:first-child > .btn-group:not(:first-child) > .btn {
        border-bottom-left-radius: 0;
        border-top-left-radius: 0
    }

    .input-group-addon:last-child {
        border-left: 0
    }

    .input-group-btn {
        font-size: 0;
        white-space: nowrap
    }

    .input-group-btn, .input-group-btn > .btn {
        position: relative
    }

    .input-group-btn > .btn + .btn {
        margin-left: -1px
    }

    .input-group-btn > .btn:hover, .input-group-btn > .btn:focus, .input-group-btn > .btn:active {
        z-index: 2
    }

    .input-group-btn:first-child > .btn, .input-group-btn:first-child > .btn-group {
        margin-right: -1px
    }

    .input-group-btn:last-child > .btn, .input-group-btn:last-child > .btn-group {
        margin-left: -1px
    }

    .pagination {
        display: inline-block;
        padding-left: 0;
        margin: 20px 0;
        border-radius: 4px
    }

    .pagination > li {
        display: inline
    }

    .pagination > li > a, .pagination > li > span {
        position: relative;
        float: left;
        padding: 6px 12px;
        line-height: 1.4285714;
        text-decoration: none;
        color: #428bca;
        background-color: #fff;
        border: 1px solid #ddd;
        margin-left: -1px
    }

    .pagination > li:first-child > a, .pagination > li:first-child > span {
        margin-left: 0;
        border-bottom-left-radius: 4px;
        border-top-left-radius: 4px
    }

    .pagination > li:last-child > a, .pagination > li:last-child > span {
        border-bottom-right-radius: 4px;
        border-top-right-radius: 4px
    }

    .pagination > li > a:hover, .pagination > li > a:focus, .pagination > li > span:hover, .pagination > li > span:focus {
        color: #2a6496;
        background-color: #eee;
        border-color: #ddd
    }

    .pagination > .active > a, .pagination > .active > a:hover, .pagination > .active > a:focus, .pagination > .active > span, .pagination > .active > span:hover, .pagination > .active > span:focus {
        z-index: 2;
        color: #fff;
        background-color: #428bca;
        border-color: #428bca;
        cursor: default
    }

    .pagination > .disabled > span, .pagination > .disabled > span:hover, .pagination > .disabled > span:focus, .pagination > .disabled > a, .pagination > .disabled > a:hover, .pagination > .disabled > a:focus {
        color: #777;
        background-color: #fff;
        border-color: #ddd;
        cursor: not-allowed
    }

    .pagination-lg > li > a, .pagination-lg > li > span {
        padding: 10px 16px;
        font-size: 18px
    }

    .pagination-lg > li:first-child > a, .pagination-lg > li:first-child > span {
        border-bottom-left-radius: 6px;
        border-top-left-radius: 6px
    }

    .pagination-lg > li:last-child > a, .pagination-lg > li:last-child > span {
        border-bottom-right-radius: 6px;
        border-top-right-radius: 6px
    }

    .pagination-sm > li > a, .pagination-sm > li > span {
        padding: 5px 10px;
        font-size: 12px
    }

    .pagination-sm > li:first-child > a, .pagination-sm > li:first-child > span {
        border-bottom-left-radius: 3px;
        border-top-left-radius: 3px
    }

    .pagination-sm > li:last-child > a, .pagination-sm > li:last-child > span {
        border-bottom-right-radius: 3px;
        border-top-right-radius: 3px
    }

    .close {
        float: right;
        font-size: 21px;
        font-weight: 700;
        line-height: 1;
        color: #000;
        text-shadow: 0 1px 0 #fff;
        opacity: .2;
        filter: alpha(opacity=20)
    }

    .close:hover, .close:focus {
        color: #000;
        text-decoration: none;
        cursor: pointer;
        opacity: .5;
        filter: alpha(opacity=50)
    }

    button.close {
        padding: 0;
        cursor: pointer;
        background: 0 0;
        border: 0;
        -webkit-appearance: none
    }

    .modal-open, .modal {
        overflow: hidden
    }

    .modal {
        display: none;
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        z-index: 1050;
        -webkit-overflow-scrolling: touch;
        outline: 0
    }

    .modal.fade .modal-dialog {
        -webkit-transform: translate3d(0, -25%, 0);
        transform: translate3d(0, -25%, 0);
        -webkit-transition: -webkit-transform .3s ease-out;
        transition: transform .3s ease-out;
        transition: transform .3s ease-out, -webkit-transform .3s ease-out
    }

    .modal.in .modal-dialog {
        -webkit-transform: translate3d(0, 0, 0);
        transform: translate3d(0, 0, 0)
    }

    .modal-open .modal {
        overflow-x: hidden;
        overflow-y: auto
    }

    .modal-dialog {
        position: relative;
        width: auto;
        margin: 10px
    }

    .modal-content {
        position: relative;
        background-color: #fff;
        border: 1px solid #999;
        border: 1px solid rgba(0, 0, 0, .2);
        border-radius: 6px;
        box-shadow: 0 3px 9px rgba(0, 0, 0, .5);
        background-clip: padding-box;
        outline: 0
    }

    .modal-backdrop {
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        z-index: 1040;
        background-color: #000
    }

    .modal-backdrop.fade {
        opacity: 0;
        filter: alpha(opacity=0)
    }

    .modal-backdrop.in {
        opacity: .5;
        filter: alpha(opacity=50)
    }

    .modal-header {
        padding: 15px;
        border-bottom: 1px solid #e5e5e5;
        min-height: 16.4285714px
    }

    .modal-header .close {
        margin-top: -2px
    }

    .modal-title {
        margin: 0;
        line-height: 1.4285714
    }

    .modal-body {
        position: relative;
        padding: 15px
    }

    .modal-footer {
        padding: 15px;
        text-align: right;
        border-top: 1px solid #e5e5e5
    }

    .modal-footer:before, .modal-footer:after {
        content: " ";
        display: table
    }

    .modal-footer:after {
        clear: both
    }

    .modal-footer .btn + .btn {
        margin-left: 5px;
        margin-bottom: 0
    }

    .modal-footer .btn-group .btn + .btn {
        margin-left: -1px
    }

    .modal-footer .btn-block + .btn-block {
        margin-left: 0
    }

    .modal-scrollbar-measure {
        position: absolute;
        top: -9999px;
        width: 50px;
        height: 50px;
        overflow: scroll
    }

    .clearfix:before, .clearfix:after {
        content: " ";
        display: table
    }

    .clearfix:after {
        clear: both
    }

    .center-block {
        display: block;
        margin-left: auto;
        margin-right: auto
    }

    .pull-right {
        float: right !important
    }

    .pull-left {
        float: left !important
    }

    .hide {
        display: none !important
    }

    .show {
        display: block !important
    }

    .invisible {
        visibility: hidden
    }

    .text-hide {
        font: 0/0 a;
        color: transparent;
        text-shadow: none;
        background-color: transparent;
        border: 0
    }

    .hidden {
        display: none !important;
        visibility: hidden !important
    }

    .affix {
        position: fixed;
        -webkit-transform: translate3d(0, 0, 0);
        transform: translate3d(0, 0, 0)
    }

    .hljs {
        display: block;
        overflow-x: auto;
        padding: .5em;
        background: #002b36;
        color: #839496;
        -webkit-text-size-adjust: none
    }

    .hljs-comment, .hljs-template_comment, .diff .hljs-header, .hljs-doctype, .hljs-pi, .lisp .hljs-string, .hljs-javadoc {
        color: #586e75
    }

    .hljs-keyword, .hljs-winutils, .method, .hljs-addition, .css .hljs-tag, .hljs-request, .hljs-status, .nginx .hljs-title {
        color: #859900
    }

    .hljs-number, .hljs-command, .hljs-string, .hljs-tag .hljs-value, .hljs-rules .hljs-value, .hljs-phpdoc, .hljs-dartdoc, .tex .hljs-formula, .hljs-regexp, .hljs-hexcolor, .hljs-link_url {
        color: #2aa198
    }

    .hljs-title, .hljs-localvars, .hljs-chunk, .hljs-decorator, .hljs-built_in, .hljs-identifier, .vhdl .hljs-literal, .hljs-id, .css .hljs-function {
        color: #268bd2
    }

    .hljs-attribute, .hljs-variable, .lisp .hljs-body, .smalltalk .hljs-number, .hljs-constant, .hljs-class .hljs-title, .hljs-parent, .hljs-type, .hljs-link_reference {
        color: #b58900
    }

    .hljs-preprocessor, .hljs-preprocessor .hljs-keyword, .hljs-pragma, .hljs-shebang, .hljs-symbol, .hljs-symbol .hljs-string, .diff .hljs-change, .hljs-special, .hljs-attr_selector, .hljs-subst, .hljs-cdata, .css .hljs-pseudo, .hljs-header {
        color: #cb4b16
    }

    .hljs-deletion, .hljs-important {
        color: #dc322f
    }

    .hljs-link_label {
        color: #6c71c4
    }

    .tex .hljs-formula {
        background: #073642
    }

    *, *:before, *:after {
        box-sizing: border-box
    }

    html {
        -ms-text-size-adjust: 100%;
        -webkit-text-size-adjust: 100%
    }

    body {
        margin: 0
    }

    article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary {
        display: block
    }

    audio, canvas, progress, video {
        display: inline-block;
        vertical-align: baseline
    }

    audio:not([controls]) {
        display: none;
        height: 0
    }

    [hidden], template {
        display: none
    }

    a {
        background: 0 0
    }

    a:active, a:hover {
        outline: 0
    }

    abbr[title] {
        border-bottom: 1px dotted
    }

    b, strong {
        font-weight: 700
    }

    dfn {
        font-style: italic
    }

    h1 {
        margin: .67em 0
    }

    mark {
        background: #ff0;
        color: #000
    }

    small {
        font-size: 80%
    }

    sub, sup {
        font-size: 75%;
        line-height: 0;
        position: relative;
        vertical-align: baseline
    }

    sup {
        top: -.5em
    }

    sub {
        bottom: -.25em
    }

    images {
        border: 0
    }

    svg:not(:root) {
        overflow: hidden
    }

    figure {
        margin: 1em 40px
    }

    hr {
        box-sizing: content-box;
        height: 0
    }

    pre {
        overflow: auto
    }

    code, kbd {
        font-size: 1em
    }

    code, kbd, pre, samp {
        font-family: monospace, monospace
    }

    samp {
        font-size: 1em
    }

    button, input, optgroup, select, textarea {
        color: inherit;
        font: inherit;
        margin: 0
    }

    button {
        overflow: visible
    }

    button, select {
        text-transform: none
    }

    button, html input[type="button"], input[type="reset"], input[type="submit"] {
        -webkit-appearance: button;
        cursor: pointer
    }

    button[disabled], html input[disabled] {
        cursor: default
    }

    button::-moz-focus-inner, input::-moz-focus-inner {
        border: 0;
        padding: 0
    }

    input {
        line-height: normal
    }

    input[type="checkbox"], input[type="radio"] {
        box-sizing: border-box;
        padding: 0
    }

    input[type="number"]::-webkit-inner-spin-button, input[type="number"]::-webkit-outer-spin-button {
        height: auto
    }

    input[type="search"] {
        -webkit-appearance: textfield;
        box-sizing: content-box
    }

    input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration {
        -webkit-appearance: none
    }

    fieldset {
        border: 1px solid silver;
        margin: 0 2px;
        padding: .35em .625em .75em
    }

    legend {
        border: 0;
        padding: 0
    }

    textarea {
        overflow: auto
    }

    optgroup {
        font-weight: 700
    }

    table {
        border-collapse: collapse;
        border-spacing: 0
    }

    .debug {
        background-color: #ffc0cb !important
    }

    .ellipsis {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap
    }

    .ir {
        background-color: transparent;
        border: 0;
        overflow: hidden
    }

    .ir::before {
        content: '';
        display: block;
        height: 150%;
        width: 0
    }

    html {
        font-size: .875em;
        background: #fff;
        color: #373D49
    }

    html, body {
        font-family: Georgia, Cambria, serif;
        height: 100%
    }

    body {
        font-size: 1rem;
        font-weight: 400;
        line-height: 2rem
    }

    ul, ol {
        margin-bottom: .83999rem;
        padding-top: .16001rem
    }

    li {
        -webkit-font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1;
        font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1;
        margin-left: 1rem
    }

    li > ul, li > ol {
        margin-bottom: 0
    }

    p {
        padding-top: .66001rem;
        -webkit-font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1;
        font-feature-settings: 'kern' 1, 'onum' 1, 'liga' 1;
        margin-top: 0
    }

    p, pre {
        margin-bottom: 1.33999rem
    }

    pre {
        font-size: 1rem;
        padding: .66001rem 9.5px 9.5px;
        line-height: 2rem;
        background: -webkit-linear-gradient(top, #fff 0, #fff .75rem, #f5f7fa .75rem, #f5f7fa 2.75rem, #fff 2.75rem, #fff 4rem);
        background: linear-gradient(to bottom, #fff 0, #fff .75rem, #f5f7fa .75rem, #f5f7fa 2.75rem, #fff 2.75rem, #fff 4rem);
        background-size: 100% 4rem;
        border-color: #D3DAEA
    }

    blockquote {
        margin: 0
    }

    blockquote p {
        font-size: 1rem;
        margin-bottom: .33999rem;
        font-style: italic;
        padding: .66001rem 1rem 1rem;
        border-left: 3px solid #A0AABF
    }

    th, td {
        padding: 12px
    }

    h1, h2, h3, h4, h5, h6 {
        font-family: "Source Sans Pro", "Helvetica Neue", Helvetica, Arial, sans-serif;
        -webkit-font-feature-settings: 'dlig' 1, 'liga' 1, 'lnum' 1, 'kern' 1;
        font-feature-settings: 'dlig' 1, 'liga' 1, 'lnum' 1, 'kern' 1;
        font-style: normal;
        font-weight: 600;
        margin-top: 0
    }

    h1 {
        line-height: 3rem;
        font-size: 2.0571429rem;
        margin-bottom: .21999rem;
        padding-top: .78001rem
    }

    h2 {
        font-size: 1.953125rem;
        margin-bottom: .1835837rem;
        padding-top: .8164163rem
    }

    h2, h3 {
        line-height: 3rem
    }

    h3 {
        font-size: 1.6457143rem;
        margin-bottom: .07599rem;
        padding-top: .92401rem
    }

    h4 {
        font-size: 1.5625rem;
        margin-bottom: .546865rem;
        padding-top: .453135rem
    }

    h5 {
        font-size: 1.25rem;
        margin-bottom: -.56251rem;
        padding-top: .56251rem
    }

    h6 {
        font-size: 1rem;
        margin-bottom: -.65001rem;
        padding-top: .65001rem
    }

    a {
        cursor: pointer;
        color: #35D7BB;
        text-decoration: none
    }

    a:hover, a:focus {
        border-bottom-color: #35D7BB;
        color: #dff9f4
    }

    img {
        height: auto;
        max-width: 100%
    }

    .g {
        display: block
    }

    .g:after {
        clear: both;
        content: '';
        display: table
    }

    .g-b {
        float: left;
        margin: 0;
        width: 100%
    }

    .g {
        margin-left: -16px;
        margin-right: -16px
    }

    .g-b {
        padding-left: 16px;
        padding-right: 16px
    }

    .g-b--center {
        display: block;
        float: none;
        margin: 0 auto
    }

    .g-b--right {
        float: right
    }

    .g-b--1of1 {
        width: 100%
    }

    .g-b--1of2, .g-b--2of4, .g-b--3of6, .g-b--4of8, .g-b--5of10, .g-b--6of12 {
        width: 50%
    }

    .g-b--1of3, .g-b--2of6, .g-b--4of12 {
        width: 33.333%
    }

    .g-b--2of3, .g-b--4of6, .g-b--8of12 {
        width: 66.666%
    }

    .g-b--1of4, .g-b--2of8, .g-b--3of12 {
        width: 25%
    }

    .g-b--3of4, .g-b--6of8, .g-b--9of12 {
        width: 75%
    }

    .g-b--1of5, .g-b--2of10 {
        width: 20%
    }

    .g-b--2of5, .g-b--4of10 {
        width: 40%
    }

    .g-b--3of5, .g-b--6of10 {
        width: 60%
    }

    .g-b--4of5, .g-b--8of10 {
        width: 80%
    }

    .g-b--1of6, .g-b--2of12 {
        width: 16.666%
    }

    .g-b--5of6, .g-b--10of12 {
        width: 83.333%
    }

    .g-b--1of8 {
        width: 12.5%
    }

    .g-b--3of8 {
        width: 37.5%
    }

    .g-b--5of8 {
        width: 62.5%
    }

    .g-b--7of8 {
        width: 87.5%
    }

    .g-b--1of10 {
        width: 10%
    }

    .g-b--3of10 {
        width: 30%
    }

    .g-b--7of10 {
        width: 70%
    }

    .g-b--9of10 {
        width: 90%
    }

    .g-b--1of12 {
        width: 8.333%
    }

    .g-b--5of12 {
        width: 41.666%
    }

    .g-b--7of12 {
        width: 58.333%
    }

    .g-b--11of12 {
        width: 91.666%
    }

    .g-b--push--1of1 {
        margin-left: 100%
    }

    .g-b--push--1of2, .g-b--push--2of4, .g-b--push--3of6, .g-b--push--4of8, .g-b--push--5of10, .g-b--push--6of12 {
        margin-left: 50%
    }

    .g-b--push--1of3, .g-b--push--2of6, .g-b--push--4of12 {
        margin-left: 33.333%
    }

    .g-b--push--2of3, .g-b--push--4of6, .g-b--push--8of12 {
        margin-left: 66.666%
    }

    .g-b--push--1of4, .g-b--push--2of8, .g-b--push--3of12 {
        margin-left: 25%
    }

    .g-b--push--3of4, .g-b--push--6of8, .g-b--push--9of12 {
        margin-left: 75%
    }

    .g-b--push--1of5, .g-b--push--2of10 {
        margin-left: 20%
    }

    .g-b--push--2of5, .g-b--push--4of10 {
        margin-left: 40%
    }

    .g-b--push--3of5, .g-b--push--6of10 {
        margin-left: 60%
    }

    .g-b--push--4of5, .g-b--push--8of10 {
        margin-left: 80%
    }

    .g-b--push--1of6, .g-b--push--2of12 {
        margin-left: 16.666%
    }

    .g-b--push--5of6, .g-b--push--10of12 {
        margin-left: 83.333%
    }

    .g-b--push--1of8 {
        margin-left: 12.5%
    }

    .g-b--push--3of8 {
        margin-left: 37.5%
    }

    .g-b--push--5of8 {
        margin-left: 62.5%
    }

    .g-b--push--7of8 {
        margin-left: 87.5%
    }

    .g-b--push--1of10 {
        margin-left: 10%
    }

    .g-b--push--3of10 {
        margin-left: 30%
    }

    .g-b--push--7of10 {
        margin-left: 70%
    }

    .g-b--push--9of10 {
        margin-left: 90%
    }

    .g-b--push--1of12 {
        margin-left: 8.333%
    }

    .g-b--push--5of12 {
        margin-left: 41.666%
    }

    .g-b--push--7of12 {
        margin-left: 58.333%
    }

    .g-b--push--11of12 {
        margin-left: 91.666%
    }

    .g-b--pull--1of1 {
        margin-right: 100%
    }

    .g-b--pull--1of2, .g-b--pull--2of4, .g-b--pull--3of6, .g-b--pull--4of8, .g-b--pull--5of10, .g-b--pull--6of12 {
        margin-right: 50%
    }

    .g-b--pull--1of3, .g-b--pull--2of6, .g-b--pull--4of12 {
        margin-right: 33.333%
    }

    .g-b--pull--2of3, .g-b--pull--4of6, .g-b--pull--8of12 {
        margin-right: 66.666%
    }

    .g-b--pull--1of4, .g-b--pull--2of8, .g-b--pull--3of12 {
        margin-right: 25%
    }

    .g-b--pull--3of4, .g-b--pull--6of8, .g-b--pull--9of12 {
        margin-right: 75%
    }

    .g-b--pull--1of5, .g-b--pull--2of10 {
        margin-right: 20%
    }

    .g-b--pull--2of5, .g-b--pull--4of10 {
        margin-right: 40%
    }

    .g-b--pull--3of5, .g-b--pull--6of10 {
        margin-right: 60%
    }

    .g-b--pull--4of5, .g-b--pull--8of10 {
        margin-right: 80%
    }

    .g-b--pull--1of6, .g-b--pull--2of12 {
        margin-right: 16.666%
    }

    .g-b--pull--5of6, .g-b--pull--10of12 {
        margin-right: 83.333%
    }

    .g-b--pull--1of8 {
        margin-right: 12.5%
    }

    .g-b--pull--3of8 {
        margin-right: 37.5%
    }

    .g-b--pull--5of8 {
        margin-right: 62.5%
    }

    .g-b--pull--7of8 {
        margin-right: 87.5%
    }

    .g-b--pull--1of10 {
        margin-right: 10%
    }

    .g-b--pull--3of10 {
        margin-right: 30%
    }

    .g-b--pull--7of10 {
        margin-right: 70%
    }

    .g-b--pull--9of10 {
        margin-right: 90%
    }

    .g-b--pull--1of12 {
        margin-right: 8.333%
    }

    .g-b--pull--5of12 {
        margin-right: 41.666%
    }

    .g-b--pull--7of12 {
        margin-right: 58.333%
    }

    .g-b--pull--11of12 {
        margin-right: 91.666%
    }

    .splashscreen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: #373D49;
        z-index: 22
    }

    .splashscreen-dillinger {
        width: 260px;
        height: auto;
        display: block;
        margin: 0 auto;
        padding-bottom: 3rem
    }

    .splashscreen p {
        font-size: 1.25rem;
        padding-top: .56251rem;
        font-family: "Source Sans Pro", "Helvetica Neue", Helvetica, Arial, sans-serif;
        font-weight: 400;
        text-align: center;
        max-width: 500px;
        margin: 0 auto;
        color: #FFF
    }

    .sp-center {
        position: relative;
        -webkit-transform: translateY(-50%);
        transform: translateY(-50%);
        top: 50%
    }

    .open-menu > .wrapper {
        overflow-x: hidden
    }

    .page {
        margin: 0 auto;
        position: relative;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 2;
        -webkit-transition: all .25s ease-in-out;
        transition: all .25s ease-in-out;
        background-color: #fff;
        padding-top: 51px;
        will-change: left
    }

    .open-menu .page {
        left: 270px
    }

    .title {
        line-height: 1rem;
        font-size: .8rem;
        margin-bottom: .77999rem;
        padding-top: .22001rem;
        font-weight: 500;
        color: #A0AABF;
        letter-spacing: 1px;
        text-transform: uppercase;
        padding-left: 16px;
        padding-right: 16px;
        margin-top: 1rem
    }

    .split-preview .title {
        padding-left: 0
    }

    .title-document {
        line-height: 1rem;
        font-size: 1.25rem;
        margin-bottom: .89999rem;
        padding-top: .10001rem;
        font-weight: 400;
        font-family: "Ubuntu Mono", Monaco;
        color: #373D49;
        padding-left: 16px;
        padding-right: 16px;
        width: 80%;
        min-width: 300px;
        outline: 0;
        border: none
    }

    .icon {
        display: block;
        margin: 0 auto;
        width: 36px;
        height: 36px;
        border-radius: 3px;
        text-align: center
    }

    .icon svg {
        display: inline-block;
        margin-left: auto;
        margin-right: auto
    }

    .icon-preview {
        background-color: #373D49;
        line-height: 40px
    }

    .icon-preview svg {
        width: 19px;
        height: 12px
    }

    .icon-settings {
        background-color: #373D49;
        line-height: 44px
    }

    .icon-settings svg {
        width: 18px;
        height: 18px
    }

    .icon-link {
        width: 16px;
        height: 16px;
        line-height: 1;
        margin-right: 24px;
        text-align: right
    }

    .navbar {
        background-color: #373D49;
        height: 51px;
        width: 100%;
        position: fixed;
        top: 0;
        left: 0;
        z-index: 6;
        -webkit-transition: all .25s ease-in-out;
        transition: all .25s ease-in-out;
        will-change: left
    }

    .navbar:after {
        content: "";
        display: table;
        clear: both
    }

    .open-menu .navbar {
        left: 270px
    }

    .navbar-brand {
        float: left;
        margin: 0 0 0 24px;
        padding: 0;
        line-height: 42px
    }

    .navbar-brand svg {
        width: 85px;
        height: 11px
    }

    .nav-left {
        float: left
    }

    .nav-right {
        float: right
    }

    .nav-sidebar {
        width: 100%
    }

    .menu {
        list-style: none;
        margin: 0;
        padding: 0
    }

    .menu a {
        border: 0;
        color: #A0AABF;
        font-family: "Source Sans Pro", "Helvetica Neue", Helvetica, Arial, sans-serif;
        outline: none;
        text-transform: uppercase
    }

    .menu a:hover {
        color: #35D7BB
    }

    .menu .menu-item {
        border: 0;
        display: none;
        float: left;
        margin: 0;
        position: relative
    }

    .menu .menu-item > a {
        display: block;
        font-size: 12px;
        height: 51px;
        letter-spacing: 1px;
        line-height: 51px;
        padding: 0 24px
    }

    .menu .menu-item--settings, .menu .menu-item--preview, .menu .menu-item--save-to.in-sidebar, .menu .menu-item--import-from.in-sidebar, .menu .menu-item--link-unlink.in-sidebar, .menu .menu-item--documents.in-sidebar {
        display: block
    }

    .menu .menu-item--documents {
        padding-bottom: 1rem
    }

    .menu .menu-item.open > a {
        background-color: #1D212A
    }

    .menu .menu-item-icon > a {
        height: auto;
        padding: 0
    }

    .menu .menu-item-icon:hover > a {
        background-color: transparent
    }

    .menu .menu-link.open i {
        background-color: #1D212A
    }

    .menu .menu-link.open g {
        fill: #35D7BB
    }

    .menu .menu-link-preview, .menu .menu-link-settings {
        margin-top: 8px;
        width: 51px
    }

    .menu-sidebar {
        width: 100%
    }

    .menu-sidebar .menu-item {
        float: none;
        margin-bottom: 1px;
        width: 100%
    }

    .menu-sidebar .menu-item.open > a {
        background-color: #373D49
    }

    .menu-sidebar .open .caret {
        -webkit-transform: rotate(180deg);
        transform: rotate(180deg)
    }

    .menu-sidebar > .menu-item:hover .dropdown a, .menu-sidebar > .menu-item:hover .settings a {
        background-color: transparent
    }

    .menu-sidebar .menu-link {
        background-color: #373D49;
        font-weight: 600
    }

    .menu-sidebar .menu-link:after {
        content: "";
        display: table;
        clear: both
    }

    .menu-sidebar .menu-link > span {
        float: left
    }

    .menu-sidebar .menu-link > .caret {
        float: right;
        text-align: right;
        top: 22px
    }

    .menu-sidebar .dropdown, .menu-sidebar .settings {
        background-color: transparent;
        position: static;
        width: 100%
    }

    .dropdown {
        position: absolute;
        right: 0;
        top: 51px;
        width: 188px
    }

    .dropdown, .settings {
        display: none;
        background-color: #1D212A
    }

    .dropdown {
        padding: 0
    }

    .dropdown, .settings, .sidebar-list {
        list-style: none;
        margin: 0
    }

    .sidebar-list {
        padding: 0
    }

    .dropdown li {
        margin: 32px 0;
        padding: 0 0 0 32px
    }

    .dropdown li, .settings li {
        line-height: 1
    }

    .sidebar-list li {
        line-height: 1;
        margin: 32px 0;
        padding: 0 0 0 32px
    }

    .dropdown a {
        color: #D0D6E2
    }

    .dropdown a, .settings a, .sidebar-list a {
        display: block;
        text-transform: none
    }

    .sidebar-list a {
        color: #D0D6E2
    }

    .dropdown a:after, .settings a:after, .sidebar-list a:after {
        content: "";
        display: table;
        clear: both
    }

    .dropdown .icon, .settings .icon, .sidebar-list .icon {
        float: right
    }

    .open .dropdown, .open .settings, .open .sidebar-list {
        display: block
    }

    .open .dropdown.collapse, .open .collapse.settings, .open .sidebar-list.collapse {
        display: none
    }

    .open .dropdown.collapse.in, .open .collapse.in.settings, .open .sidebar-list.collapse.in {
        display: block
    }

    .dropdown .unlinked .icon, .settings .unlinked .icon, .sidebar-list .unlinked .icon {
        opacity: .3
    }

    .dropdown.documents li, .documents.settings li, .sidebar-list.documents li {
        background-image: url("../img/icons/file.svg");
        background-position: 240px center;
        background-repeat: no-repeat;
        background-size: 14px 16px;
        padding: 3px 32px
    }

    .dropdown.documents li.octocat, .documents.settings li.octocat, .sidebar-list.documents li.octocat {
        background-image: url("../img/icons/octocat.svg");
        background-position: 234px center;
        background-size: 24px 24px
    }

    .dropdown.documents li:last-child, .documents.settings li:last-child, .sidebar-list.documents li:last-child {
        margin-bottom: 1rem
    }

    .dropdown.documents li.active a, .documents.settings li.active a, .sidebar-list.documents li.active a {
        color: #35D7BB
    }

    .settings {
        position: fixed;
        top: 67px;
        right: 16px;
        border-radius: 3px;
        width: 288px;
        background-color: #373D49;
        padding: 16px;
        z-index: 7
    }

    .show-settings .settings {
        display: block
    }

    .settings .has-checkbox {
        float: left
    }

    .settings a {
        font-size: 1.25rem;
        font-family: "Source Sans Pro", "Helvetica Neue", Helvetica, Arial, sans-serif;
        font-weight: 400;
        -webkit-font-smoothing: antialiased;
        line-height: 28px;
        color: #D0D6E2
    }

    .settings a:after {
        content: "";
        display: table;
        clear: both
    }

    .settings a:hover {
        color: #35D7BB
    }

    .settings li {
        border-bottom: 1px solid #4F535B;
        margin: 0;
        padding: 16px 0
    }

    .settings li:last-child {
        border-bottom: none
    }

    .brand {
        border: none;
        display: block
    }

    .brand:hover g {
        fill: #35D7BB
    }

    .toggle {
        display: block;
        float: left;
        height: 16px;
        padding: 25px 16px 26px;
        width: 40px
    }

    .toggle span:after, .toggle span:before {
        content: '';
        left: 0;
        position: absolute;
        top: -6px
    }

    .toggle span:after {
        top: 6px
    }

    .toggle span {
        display: block;
        position: relative
    }

    .toggle span, .toggle span:after, .toggle span:before {
        -webkit-backface-visibility: hidden;
        backface-visibility: hidden;
        background-color: #D3DAEA;
        height: 2px;
        -webkit-transition: all .3s;
        transition: all .3s;
        width: 20px
    }

    .open-menu .toggle span {
        background-color: transparent
    }

    .open-menu .toggle span:before {
        -webkit-transform: rotate(45deg) translate(3px, 3px);
        transform: rotate(45deg) translate(3px, 3px)
    }

    .open-menu .toggle span:after {
        -webkit-transform: rotate(-45deg) translate(5px, -6px);
        transform: rotate(-45deg) translate(5px, -6px)
    }

    .caret {
        display: inline-block;
        width: 0;
        height: 0;
        margin-left: 6px;
        vertical-align: middle;
        position: relative;
        top: -1px;
        border-top: 4px solid;
        border-right: 4px solid transparent;
        border-left: 4px solid transparent
    }

    .sidebar {
        overflow: auto;
        height: 100%;
        padding-right: 15px;
        padding-bottom: 15px;
        width: 285px
    }

    .sidebar-wrapper {
        -webkit-overflow-scrolling: touch;
        background-color: #2B2F36;
        left: 0;
        height: 100%;
        overflow-y: hidden;
        position: fixed;
        top: 0;
        width: 285px;
        z-index: 1
    }

    .sidebar-branding {
        width: 160px;
        padding: 0;
        margin: 16px auto
    }

    .header {
        border-bottom: 1px solid #E8E8E8;
        position: relative
    }

    .words {
        line-height: 1rem;
        font-size: .8rem;
        margin-bottom: .77999rem;
        padding-top: .22001rem;
        font-weight: 500;
        font-family: "Source Sans Pro", "Helvetica Neue", Helvetica, Arial, sans-serif;
        color: #A0AABF;
        letter-spacing: 1px;
        text-transform: uppercase;
        z-index: 5;
        position: absolute;
        right: 16px;
        top: 0
    }

    .words span {
        color: #000
    }

    .btn {
        text-align: center;
        display: inline-block;
        width: 100%;
        text-transform: uppercase;
        font-weight: 600;
        font-family: "Source Sans Pro", "Helvetica Neue", Helvetica, Arial, sans-serif;
        font-size: 14px;
        text-shadow: 0 1px 0 #1b8b77;
        padding: 16px 24px;
        background-color: #35D7BB;
        border-radius: 3px;
        margin: 0 auto 16px;
        line-height: 1;
        color: #fff;
        -webkit-transition: all .15s linear;
        transition: all .15s linear;
        -webkit-font-smoothing: antialiased
    }

    .btn--new, .btn--save {
        display: block;
        width: 238px
    }

    .btn--new:hover, .btn--new:focus, .btn--save:hover, .btn--save:focus {
        color: #fff;
        border-bottom-color: transparent;
        box-shadow: 0 1px 3px #24b59c;
        text-shadow: 0 1px 0 #24b59c
    }

    .btn--save {
        background-color: #4A5261;
        text-shadow: 0 1px 1px #1e2127
    }

    .btn--save:hover, .btn--save:focus {
        color: #fff;
        border-bottom-color: transparent;
        box-shadow: 0 1px 5px #08090a;
        text-shadow: none
    }

    .btn--delete {
        display: block;
        width: 238px;
        background-color: transparent;
        font-size: 12px;
        text-shadow: none
    }

    .btn--delete:hover, .btn--delete:focus {
        color: #fff;
        border-bottom-color: transparent;
        text-shadow: 0 1px 0 #08090a;
        opacity: .8
    }

    .btn--delete-modal, .btn--ok, .btn--close {
        border-top: 0;
        background-color: #4A5261;
        text-shadow: 0 1px 0 #08090a;
        margin: 0
    }

    .btn--delete-modal:hover, .btn--delete-modal:focus, .btn--ok:hover, .btn--ok:focus, .btn--close:hover, .btn--close:focus {
        color: #fff;
        background-color: #292d36;
        text-shadow: none
    }

    .btn--delete-modal {
        display: inline;
        width: auto
    }

    .overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(55, 61, 73, .8);
        -webkit-transition: all .25s ease-in-out;
        transition: all .25s ease-in-out;
        -webkit-transition-timing-function: ease-out;
        transition-timing-function: ease-out;
        will-change: left, opacity, visibility;
        z-index: 5;
        opacity: 0;
        visibility: hidden
    }

    .show-settings .overlay {
        visibility: visible;
        opacity: 1
    }

    .switch {
        float: right;
        line-height: 1
    }

    .switch input {
        display: none
    }

    .switch small {
        display: inline-block;
        cursor: pointer;
        padding: 0 24px 0 0;
        -webkit-transition: all ease .2s;
        transition: all ease .2s;
        background-color: #2B2F36;
        border-color: #2B2F36
    }

    .switch small, .switch small:before {
        border-radius: 30px;
        box-shadow: inset 0 0 2px 0 #14171F
    }

    .switch small:before {
        display: block;
        content: '';
        width: 28px;
        height: 28px;
        background: #fff
    }

    .switch.checked small {
        padding-right: 0;
        padding-left: 24px;
        background-color: #35D7BB;
        box-shadow: none
    }

    .modal--dillinger.about .modal-dialog {
        font-size: 1.25rem;
        max-width: 500px
    }

    .modal--dillinger.scope .modal-dialog {
        max-width: 300px;
        margin: 5rem auto
    }

    .modal--dillinger .modal-dialog {
        max-width: 600px;
        width: auto;
        margin: 5rem auto
    }

    .modal--dillinger .modal-content {
        background: #373D49;
        border-radius: 3px;
        box-shadow: 0 2px 5px 0 #2C3B59;
        color: #fff;
        font-family: "Source Sans Pro", "Helvetica Neue", Helvetica, Arial, sans-serif;
        font-weight: 400;
        padding: 2rem
    }

    .modal--dillinger ul {
        list-style-type: disc;
        margin: 1rem 0;
        padding: 0 0 0 1rem
    }

    .modal--dillinger li {
        padding: 0;
        margin: 0
    }

    .modal--dillinger .modal-header {
        border: 0;
        padding: 0
    }

    .modal--dillinger .modal-body {
        padding: 0
    }

    .modal--dillinger .modal-footer {
        border: 0;
        padding: 0
    }

    .modal--dillinger .close {
        color: #fff;
        opacity: 1
    }

    .modal-backdrop {
        background-color: #373D49
    }

    .pagination--dillinger {
        padding: 0 !important;
        margin: 1.5rem 0 !important;
        -webkit-box-pack: justify;
        -ms-flex-pack: justify;
        justify-content: space-between;
        -webkit-box-orient: horizontal;
        -webkit-box-direction: normal;
        -ms-flex-direction: row;
        flex-direction: row;
        -webkit-box-align: center;
        -ms-flex-align: center;
        align-items: center;
        -ms-flex-line-pack: stretch;
        align-content: stretch
    }

    .pagination--dillinger, .pagination--dillinger li {
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex
    }

    .pagination--dillinger li {
        -webkit-box-flex: 1;
        -ms-flex-positive: 1;
        flex-grow: 1;
        text-align: center
    }

    .pagination--dillinger li:first-child > a, .pagination--dillinger li.disabled > a, .pagination--dillinger li.disabled > a:hover, .pagination--dillinger li.disabled > a:focus, .pagination--dillinger li > a {
        background-color: transparent;
        border-color: #4F535B;
        border-right-color: transparent
    }

    .pagination--dillinger li.active > a, .pagination--dillinger li.active > a:hover, .pagination--dillinger li.active > a:focus {
        border-color: #4A5261;
        background-color: #4A5261;
        color: #fff
    }

    .pagination--dillinger li > a {
        float: none;
        color: #fff;
        width: 100%;
        display: block;
        text-align: center;
        margin: 0;
        border-right-color: transparent;
        padding: 6px
    }

    .pagination--dillinger li > a:hover, .pagination--dillinger li > a:focus {
        border-color: #35D7BB;
        background-color: #35D7BB;
        color: #fff
    }

    .pagination--dillinger li:last-child a {
        border-color: #4F535B
    }

    .pagination--dillinger li:first-child a {
        border-right-color: transparent
    }

    .diNotify {
        position: absolute;
        z-index: 9999;
        left: 0;
        right: 0;
        top: 0;
        margin: 0 auto;
        max-width: 400px;
        text-align: center;
        -webkit-transition: top .5s ease-in-out, opacity .5s ease-in-out;
        transition: top .5s ease-in-out, opacity .5s ease-in-out;
        visibility: hidden
    }

    .diNotify-body {
        -webkit-font-smoothing: antialiased;
        background-color: #35D7BB;
        background: #666E7F;
        border-radius: 3px;
        color: #fff;
        font-family: "Source Sans Pro", "Helvetica Neue", Helvetica, Arial, sans-serif;
        font-weight: 400;
        overflow: hidden;
        padding: 1rem 2rem .5rem;
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        -webkit-box-align: baseline;
        -ms-flex-align: baseline;
        align-items: baseline;
        -webkit-box-pack: center;
        -ms-flex-pack: center;
        justify-content: center
    }

    .diNotify-icon {
        display: block;
        width: 16px;
        height: 16px;
        line-height: 16px;
        position: relative;
        top: 3px
    }

    .diNotify-message {
        padding-left: 1rem
    }

    .zen-wrapper {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        width: 100%;
        height: 100%;
        z-index: 10;
        background-color: #FFF;
        opacity: 0;
        -webkit-transition: opacity .25s ease-in-out;
        transition: opacity .25s ease-in-out
    }

    .zen-wrapper.on {
        opacity: 1
    }

    .enter-zen-mode {
        background-image: url("../img/icons/enter-zen.svg");
        right: .5rem;
        top: .313rem;
        display: none
    }

    .enter-zen-mode, .close-zen-mode {
        font: 0/0 a;
        color: transparent;
        text-shadow: none;
        background-color: transparent;
        border: 0;
        background-repeat: no-repeat;
        width: 32px;
        height: 32px;
        display: block;
        position: absolute
    }

    .close-zen-mode {
        background-image: url("../img/icons/exit-zen.svg");
        right: 1rem;
        top: 1rem
    }

    .zen-page {
        position: relative;
        top: 0;
        bottom: 0;
        z-index: 11;
        height: 100%;
        width: 100%
    }

    #zen {
        font-size: 1.25rem;
        width: 300px;
        height: 80%;
        margin: 0 auto;
        position: relative;
        top: 10%
    }

    #zen:before, #zen:after {
        content: "";
        position: absolute;
        height: 10%;
        width: 100%;
        z-index: 12;
        pointer-events: none
    }

    #preview .table {
        width: auto
    }

    .split {
        overflow: scroll;
        padding: 0 !important
    }

    .split-editor {
        padding-left: 0;
        padding-right: 0;
        position: relative
    }

    .show-preview .split-editor {
        display: none
    }

    .split-preview {
        background-color: #fff;
        display: none;
        top: 0;
        position: relative;
        z-index: 4
    }

    .show-preview .split-preview {
        display: block
    }

    #editor {
        font-size: 1rem;
        font-family: "Ubuntu Mono", Monaco;
        font-weight: 400;
        line-height: 2rem;
        width: 100%;
        height: 100%
    }

    #editor .ace_gutter {
        -webkit-font-smoothing: antialiased
    }

    .editor-header {
        width: 50%;
        float: left;
        border-bottom: 1px solid #E8E8E8;
        position: relative
    }

    .editor-header--first {
        border-right: 1px solid #E8E8E8
    }

    .editor-header .title {
        display: inline-block
    }

    #preview {
        padding: 10px
    }

    #preview a {
        color: #A0AABF;
        text-decoration: underline
    }

    .sr-only {
        visibility: hidden;
        text-overflow: 110%;
        overflow: hidden;
        top: -100px;
        position: absolute
    }

    .mnone {
        margin: 0 !important
    }

    @media (min-width: 768px) {
        .form-inline .form-group {
            display: inline-block;
            margin-bottom: 0;
            vertical-align: middle
        }

        .form-inline .form-control {
            display: inline-block;
            width: auto;
            vertical-align: middle
        }

        .form-inline .input-group {
            display: inline-table;
            vertical-align: middle
        }

        .form-inline .input-group .input-group-addon, .form-inline .input-group .input-group-btn, .form-inline .input-group .form-control {
            width: auto
        }

        .form-inline .input-group > .form-control {
            width: 100%
        }

        .form-inline .control-label {
            margin-bottom: 0;
            vertical-align: middle
        }

        .form-inline .radio, .form-inline .checkbox {
            display: inline-block;
            margin-top: 0;
            margin-bottom: 0;
            vertical-align: middle
        }

        .form-inline .radio label, .form-inline .checkbox label {
            padding-left: 0
        }

        .form-inline .radio input[type="radio"], .form-inline .checkbox input[type="checkbox"] {
            position: relative;
            margin-left: 0
        }

        .form-inline .has-feedback .form-control-feedback {
            top: 0
        }

        .form-horizontal .control-label {
            text-align: right;
            margin-bottom: 0;
            padding-top: 7px
        }

        .form-horizontal .form-group-lg .control-label {
            padding-top: 14.3px
        }

        .form-horizontal .form-group-sm .control-label {
            padding-top: 6px
        }

        .modal-dialog {
            width: 600px;
            margin: 30px auto
        }

        .modal-content {
            box-shadow: 0 5px 15px rgba(0, 0, 0, .5)
        }

        .modal-sm {
            width: 300px
        }
    }

    @media (min-width: 992px) {
        .modal-lg {
            width: 900px
        }
    }

    @media screen and (max-width: 767px) {
        .table-responsive {
            width: 100%;
            margin-bottom: 15px;
            overflow-y: hidden;
            overflow-x: auto;
            -ms-overflow-style: -ms-autohiding-scrollbar;
            border: 1px solid #ddd;
            -webkit-overflow-scrolling: touch
        }

        .table-responsive > .table {
            margin-bottom: 0
        }

        .table-responsive > .table > thead > tr > th, .table-responsive > .table > thead > tr > td, .table-responsive > .table > tbody > tr > th, .table-responsive > .table > tbody > tr > td, .table-responsive > .table > tfoot > tr > th, .table-responsive > .table > tfoot > tr > td {
            white-space: nowrap
        }

        .table-responsive > .table-bordered {
            border: 0
        }

        .table-responsive > .table-bordered > thead > tr > th:first-child, .table-responsive > .table-bordered > thead > tr > td:first-child, .table-responsive > .table-bordered > tbody > tr > th:first-child, .table-responsive > .table-bordered > tbody > tr > td:first-child, .table-responsive > .table-bordered > tfoot > tr > th:first-child, .table-responsive > .table-bordered > tfoot > tr > td:first-child {
            border-left: 0
        }

        .table-responsive > .table-bordered > thead > tr > th:last-child, .table-responsive > .table-bordered > thead > tr > td:last-child, .table-responsive > .table-bordered > tbody > tr > th:last-child, .table-responsive > .table-bordered > tbody > tr > td:last-child, .table-responsive > .table-bordered > tfoot > tr > th:last-child, .table-responsive > .table-bordered > tfoot > tr > td:last-child {
            border-right: 0
        }

        .table-responsive > .table-bordered > tbody > tr:last-child > th, .table-responsive > .table-bordered > tbody > tr:last-child > td, .table-responsive > .table-bordered > tfoot > tr:last-child > th, .table-responsive > .table-bordered > tfoot > tr:last-child > td {
            border-bottom: 0
        }
    }

    @media screen and (min-width: 27.5em) {
        html {
            font-size: .875em
        }

        body {
            font-size: 1rem
        }

        ul, ol {
            margin-bottom: .83999rem;
            padding-top: .16001rem
        }

        p {
            padding-top: .66001rem
        }

        p, pre {
            margin-bottom: 1.33999rem
        }

        pre, blockquote p {
            font-size: 1rem;
            padding-top: .66001rem
        }

        blockquote p {
            margin-bottom: .33999rem
        }

        h1 {
            font-size: 2.0571429rem;
            margin-bottom: .21999rem;
            padding-top: .78001rem
        }

        h2 {
            font-size: 1.953125rem;
            margin-bottom: .1835837rem;
            padding-top: .8164163rem
        }

        h3 {
            font-size: 1.6457143rem;
            margin-bottom: .07599rem;
            padding-top: .92401rem
        }

        h4 {
            font-size: 1.5625rem;
            margin-bottom: .546865rem;
            padding-top: .453135rem
        }

        h5 {
            font-size: 1.25rem;
            margin-bottom: -.56251rem;
            padding-top: .56251rem
        }

        h6 {
            font-size: 1rem;
            margin-bottom: -.65001rem;
            padding-top: .65001rem
        }

        .g {
            margin-left: -16px;
            margin-right: -16px
        }

        .g-b {
            padding-left: 16px;
            padding-right: 16px
        }

        .g-b--m1of1 {
            width: 100%
        }

        .g-b--m1of2, .g-b--m2of4, .g-b--m3of6, .g-b--m4of8, .g-b--m5of10, .g-b--m6of12 {
            width: 50%
        }

        .g-b--m1of3, .g-b--m2of6, .g-b--m4of12 {
            width: 33.333%
        }

        .g-b--m2of3, .g-b--m4of6, .g-b--m8of12 {
            width: 66.666%
        }

        .g-b--m1of4, .g-b--m2of8, .g-b--m3of12 {
            width: 25%
        }

        .g-b--m3of4, .g-b--m6of8, .g-b--m9of12 {
            width: 75%
        }

        .g-b--m1of5, .g-b--m2of10 {
            width: 20%
        }

        .g-b--m2of5, .g-b--m4of10 {
            width: 40%
        }

        .g-b--m3of5, .g-b--m6of10 {
            width: 60%
        }

        .g-b--m4of5, .g-b--m8of10 {
            width: 80%
        }

        .g-b--m1of6, .g-b--m2of12 {
            width: 16.666%
        }

        .g-b--m5of6, .g-b--m10of12 {
            width: 83.333%
        }

        .g-b--m1of8 {
            width: 12.5%
        }

        .g-b--m3of8 {
            width: 37.5%
        }

        .g-b--m5of8 {
            width: 62.5%
        }

        .g-b--m7of8 {
            width: 87.5%
        }

        .g-b--m1of10 {
            width: 10%
        }

        .g-b--m3of10 {
            width: 30%
        }

        .g-b--m7of10 {
            width: 70%
        }

        .g-b--m9of10 {
            width: 90%
        }

        .g-b--m1of12 {
            width: 8.333%
        }

        .g-b--m5of12 {
            width: 41.666%
        }

        .g-b--m7of12 {
            width: 58.333%
        }

        .g-b--m11of12 {
            width: 91.666%
        }

        .g-b--push--m1of1 {
            margin-left: 100%
        }

        .g-b--push--m1of2, .g-b--push--m2of4, .g-b--push--m3of6, .g-b--push--m4of8, .g-b--push--m5of10, .g-b--push--m6of12 {
            margin-left: 50%
        }

        .g-b--push--m1of3, .g-b--push--m2of6, .g-b--push--m4of12 {
            margin-left: 33.333%
        }

        .g-b--push--m2of3, .g-b--push--m4of6, .g-b--push--m8of12 {
            margin-left: 66.666%
        }

        .g-b--push--m1of4, .g-b--push--m2of8, .g-b--push--m3of12 {
            margin-left: 25%
        }

        .g-b--push--m3of4, .g-b--push--m6of8, .g-b--push--m9of12 {
            margin-left: 75%
        }

        .g-b--push--m1of5, .g-b--push--m2of10 {
            margin-left: 20%
        }

        .g-b--push--m2of5, .g-b--push--m4of10 {
            margin-left: 40%
        }

        .g-b--push--m3of5, .g-b--push--m6of10 {
            margin-left: 60%
        }

        .g-b--push--m4of5, .g-b--push--m8of10 {
            margin-left: 80%
        }

        .g-b--push--m1of6, .g-b--push--m2of12 {
            margin-left: 16.666%
        }

        .g-b--push--m5of6, .g-b--push--m10of12 {
            margin-left: 83.333%
        }

        .g-b--push--m1of8 {
            margin-left: 12.5%
        }

        .g-b--push--m3of8 {
            margin-left: 37.5%
        }

        .g-b--push--m5of8 {
            margin-left: 62.5%
        }

        .g-b--push--m7of8 {
            margin-left: 87.5%
        }

        .g-b--push--m1of10 {
            margin-left: 10%
        }

        .g-b--push--m3of10 {
            margin-left: 30%
        }

        .g-b--push--m7of10 {
            margin-left: 70%
        }

        .g-b--push--m9of10 {
            margin-left: 90%
        }

        .g-b--push--m1of12 {
            margin-left: 8.333%
        }

        .g-b--push--m5of12 {
            margin-left: 41.666%
        }

        .g-b--push--m7of12 {
            margin-left: 58.333%
        }

        .g-b--push--m11of12 {
            margin-left: 91.666%
        }

        .g-b--pull--m1of1 {
            margin-right: 100%
        }

        .g-b--pull--m1of2, .g-b--pull--m2of4, .g-b--pull--m3of6, .g-b--pull--m4of8, .g-b--pull--m5of10, .g-b--pull--m6of12 {
            margin-right: 50%
        }

        .g-b--pull--m1of3, .g-b--pull--m2of6, .g-b--pull--m4of12 {
            margin-right: 33.333%
        }

        .g-b--pull--m2of3, .g-b--pull--m4of6, .g-b--pull--m8of12 {
            margin-right: 66.666%
        }

        .g-b--pull--m1of4, .g-b--pull--m2of8, .g-b--pull--m3of12 {
            margin-right: 25%
        }

        .g-b--pull--m3of4, .g-b--pull--m6of8, .g-b--pull--m9of12 {
            margin-right: 75%
        }

        .g-b--pull--m1of5, .g-b--pull--m2of10 {
            margin-right: 20%
        }

        .g-b--pull--m2of5, .g-b--pull--m4of10 {
            margin-right: 40%
        }

        .g-b--pull--m3of5, .g-b--pull--m6of10 {
            margin-right: 60%
        }

        .g-b--pull--m4of5, .g-b--pull--m8of10 {
            margin-right: 80%
        }

        .g-b--pull--m1of6, .g-b--pull--m2of12 {
            margin-right: 16.666%
        }

        .g-b--pull--m5of6, .g-b--pull--m10of12 {
            margin-right: 83.333%
        }

        .g-b--pull--m1of8 {
            margin-right: 12.5%
        }

        .g-b--pull--m3of8 {
            margin-right: 37.5%
        }

        .g-b--pull--m5of8 {
            margin-right: 62.5%
        }

        .g-b--pull--m7of8 {
            margin-right: 87.5%
        }

        .g-b--pull--m1of10 {
            margin-right: 10%
        }

        .g-b--pull--m3of10 {
            margin-right: 30%
        }

        .g-b--pull--m7of10 {
            margin-right: 70%
        }

        .g-b--pull--m9of10 {
            margin-right: 90%
        }

        .g-b--pull--m1of12 {
            margin-right: 8.333%
        }

        .g-b--pull--m5of12 {
            margin-right: 41.666%
        }

        .g-b--pull--m7of12 {
            margin-right: 58.333%
        }

        .g-b--pull--m11of12 {
            margin-right: 91.666%
        }

        .splashscreen p {
            font-size: 1.25rem;
            margin-bottom: 1.43749rem;
            padding-top: .56251rem
        }

        .title {
            font-size: .8rem;
            margin-bottom: .77999rem;
            padding-top: .22001rem
        }

        .title-document {
            margin-bottom: .89999rem;
            padding-top: .10001rem
        }

        .title-document, .settings a {
            font-size: 1.25rem
        }

        .words {
            font-size: .8rem;
            margin-bottom: .77999rem;
            padding-top: .22001rem
        }

        .modal--dillinger.about .modal-dialog, #zen {
            font-size: 1.25rem
        }

        #zen {
            width: 400px
        }

        #editor {
            font-size: 1rem
        }
    }

    @media screen and (min-width: 46.25em) {
        html {
            font-size: .875em
        }

        body {
            font-size: 1rem
        }

        ul, ol {
            margin-bottom: .83999rem;
            padding-top: .16001rem
        }

        p {
            padding-top: .66001rem
        }

        p, pre {
            margin-bottom: 1.33999rem
        }

        pre, blockquote p {
            font-size: 1rem;
            padding-top: .66001rem
        }

        blockquote p {
            margin-bottom: .33999rem
        }

        h1 {
            font-size: 2.0571429rem;
            margin-bottom: .21999rem;
            padding-top: .78001rem
        }

        h2 {
            font-size: 1.953125rem;
            margin-bottom: .1835837rem;
            padding-top: .8164163rem
        }

        h3 {
            font-size: 1.6457143rem;
            margin-bottom: .07599rem;
            padding-top: .92401rem
        }

        h4 {
            font-size: 1.5625rem;
            margin-bottom: .546865rem;
            padding-top: .453135rem
        }

        h5 {
            font-size: 1.25rem;
            margin-bottom: -.56251rem;
            padding-top: .56251rem
        }

        h6 {
            font-size: 1rem;
            margin-bottom: -.65001rem;
            padding-top: .65001rem
        }

        .g {
            margin-left: -16px;
            margin-right: -16px
        }

        .g-b {
            padding-left: 16px;
            padding-right: 16px
        }

        .g-b--t1of1 {
            width: 100%
        }

        .g-b--t1of2, .g-b--t2of4, .g-b--t3of6, .g-b--t4of8, .g-b--t5of10, .g-b--t6of12 {
            width: 50%
        }

        .g-b--t1of3, .g-b--t2of6, .g-b--t4of12 {
            width: 33.333%
        }

        .g-b--t2of3, .g-b--t4of6, .g-b--t8of12 {
            width: 66.666%
        }

        .g-b--t1of4, .g-b--t2of8, .g-b--t3of12 {
            width: 25%
        }

        .g-b--t3of4, .g-b--t6of8, .g-b--t9of12 {
            width: 75%
        }

        .g-b--t1of5, .g-b--t2of10 {
            width: 20%
        }

        .g-b--t2of5, .g-b--t4of10 {
            width: 40%
        }

        .g-b--t3of5, .g-b--t6of10 {
            width: 60%
        }

        .g-b--t4of5, .g-b--t8of10 {
            width: 80%
        }

        .g-b--t1of6, .g-b--t2of12 {
            width: 16.666%
        }

        .g-b--t5of6, .g-b--t10of12 {
            width: 83.333%
        }

        .g-b--t1of8 {
            width: 12.5%
        }

        .g-b--t3of8 {
            width: 37.5%
        }

        .g-b--t5of8 {
            width: 62.5%
        }

        .g-b--t7of8 {
            width: 87.5%
        }

        .g-b--t1of10 {
            width: 10%
        }

        .g-b--t3of10 {
            width: 30%
        }

        .g-b--t7of10 {
            width: 70%
        }

        .g-b--t9of10 {
            width: 90%
        }

        .g-b--t1of12 {
            width: 8.333%
        }

        .g-b--t5of12 {
            width: 41.666%
        }

        .g-b--t7of12 {
            width: 58.333%
        }

        .g-b--t11of12 {
            width: 91.666%
        }

        .g-b--push--t1of1 {
            margin-left: 100%
        }

        .g-b--push--t1of2, .g-b--push--t2of4, .g-b--push--t3of6, .g-b--push--t4of8, .g-b--push--t5of10, .g-b--push--t6of12 {
            margin-left: 50%
        }

        .g-b--push--t1of3, .g-b--push--t2of6, .g-b--push--t4of12 {
            margin-left: 33.333%
        }

        .g-b--push--t2of3, .g-b--push--t4of6, .g-b--push--t8of12 {
            margin-left: 66.666%
        }

        .g-b--push--t1of4, .g-b--push--t2of8, .g-b--push--t3of12 {
            margin-left: 25%
        }

        .g-b--push--t3of4, .g-b--push--t6of8, .g-b--push--t9of12 {
            margin-left: 75%
        }

        .g-b--push--t1of5, .g-b--push--t2of10 {
            margin-left: 20%
        }

        .g-b--push--t2of5, .g-b--push--t4of10 {
            margin-left: 40%
        }

        .g-b--push--t3of5, .g-b--push--t6of10 {
            margin-left: 60%
        }

        .g-b--push--t4of5, .g-b--push--t8of10 {
            margin-left: 80%
        }

        .g-b--push--t1of6, .g-b--push--t2of12 {
            margin-left: 16.666%
        }

        .g-b--push--t5of6, .g-b--push--t10of12 {
            margin-left: 83.333%
        }

        .g-b--push--t1of8 {
            margin-left: 12.5%
        }

        .g-b--push--t3of8 {
            margin-left: 37.5%
        }

        .g-b--push--t5of8 {
            margin-left: 62.5%
        }

        .g-b--push--t7of8 {
            margin-left: 87.5%
        }

        .g-b--push--t1of10 {
            margin-left: 10%
        }

        .g-b--push--t3of10 {
            margin-left: 30%
        }

        .g-b--push--t7of10 {
            margin-left: 70%
        }

        .g-b--push--t9of10 {
            margin-left: 90%
        }

        .g-b--push--t1of12 {
            margin-left: 8.333%
        }

        .g-b--push--t5of12 {
            margin-left: 41.666%
        }

        .g-b--push--t7of12 {
            margin-left: 58.333%
        }

        .g-b--push--t11of12 {
            margin-left: 91.666%
        }

        .g-b--pull--t1of1 {
            margin-right: 100%
        }

        .g-b--pull--t1of2, .g-b--pull--t2of4, .g-b--pull--t3of6, .g-b--pull--t4of8, .g-b--pull--t5of10, .g-b--pull--t6of12 {
            margin-right: 50%
        }

        .g-b--pull--t1of3, .g-b--pull--t2of6, .g-b--pull--t4of12 {
            margin-right: 33.333%
        }

        .g-b--pull--t2of3, .g-b--pull--t4of6, .g-b--pull--t8of12 {
            margin-right: 66.666%
        }

        .g-b--pull--t1of4, .g-b--pull--t2of8, .g-b--pull--t3of12 {
            margin-right: 25%
        }

        .g-b--pull--t3of4, .g-b--pull--t6of8, .g-b--pull--t9of12 {
            margin-right: 75%
        }

        .g-b--pull--t1of5, .g-b--pull--t2of10 {
            margin-right: 20%
        }

        .g-b--pull--t2of5, .g-b--pull--t4of10 {
            margin-right: 40%
        }

        .g-b--pull--t3of5, .g-b--pull--t6of10 {
            margin-right: 60%
        }

        .g-b--pull--t4of5, .g-b--pull--t8of10 {
            margin-right: 80%
        }

        .g-b--pull--t1of6, .g-b--pull--t2of12 {
            margin-right: 16.666%
        }

        .g-b--pull--t5of6, .g-b--pull--t10of12 {
            margin-right: 83.333%
        }

        .g-b--pull--t1of8 {
            margin-right: 12.5%
        }

        .g-b--pull--t3of8 {
            margin-right: 37.5%
        }

        .g-b--pull--t5of8 {
            margin-right: 62.5%
        }

        .g-b--pull--t7of8 {
            margin-right: 87.5%
        }

        .g-b--pull--t1of10 {
            margin-right: 10%
        }

        .g-b--pull--t3of10 {
            margin-right: 30%
        }

        .g-b--pull--t7of10 {
            margin-right: 70%
        }

        .g-b--pull--t9of10 {
            margin-right: 90%
        }

        .g-b--pull--t1of12 {
            margin-right: 8.333%
        }

        .g-b--pull--t5of12 {
            margin-right: 41.666%
        }

        .g-b--pull--t7of12 {
            margin-right: 58.333%
        }

        .g-b--pull--t11of12 {
            margin-right: 91.666%
        }

        .splashscreen-dillinger {
            width: 500px
        }

        .splashscreen p {
            font-size: 1.25rem;
            margin-bottom: 1.43749rem;
            padding-top: .56251rem
        }

        .title {
            font-size: .8rem;
            margin-bottom: .77999rem;
            padding-top: .22001rem
        }

        .title-document {
            font-size: 1.25rem;
            margin-bottom: .89999rem;
            padding-top: .10001rem
        }

        .menu .menu-item--save-to, .menu .menu-item--import-from {
            display: block
        }

        .menu .menu-item--preview, .menu .menu-item--save-to.in-sidebar, .menu .menu-item--import-from.in-sidebar {
            display: none
        }

        .settings a {
            font-size: 1.25rem
        }

        .words {
            font-size: .8rem;
            margin-bottom: .77999rem;
            padding-top: .22001rem
        }

        .modal--dillinger.about .modal-dialog {
            font-size: 1.25rem
        }

        .enter-zen-mode {
            display: block
        }

        .close-zen-mode {
            right: 3rem;
            top: 3rem
        }

        #zen {
            font-size: 1.25rem;
            width: 500px
        }

        .split-editor {
            border-right: 1px solid #E8E8E8;
            float: left;
            height: calc(100vh - 172px);
            -webkit-overflow-scrolling: touch;
            padding-right: 16px;
            width: 50%
        }

        .show-preview .split-editor {
            display: block
        }

        .split-preview {
            display: block;
            float: right;
            height: calc(100vh - 172px);
            -webkit-overflow-scrolling: touch;
            position: relative;
            top: 0;
            width: 50%
        }

        #editor {
            font-size: 1rem
        }
    }

    @media screen and (min-width: 62.5em) {
        html {
            font-size: .875em
        }

        body {
            font-size: 1rem
        }

        ul, ol {
            margin-bottom: .83999rem;
            padding-top: .16001rem
        }

        p {
            padding-top: .66001rem
        }

        p, pre {
            margin-bottom: 1.33999rem
        }

        pre, blockquote p {
            font-size: 1rem;
            padding-top: .66001rem
        }

        blockquote p {
            margin-bottom: .33999rem
        }

        h1 {
            font-size: 2.0571429rem;
            margin-bottom: .21999rem;
            padding-top: .78001rem
        }

        h2 {
            font-size: 1.953125rem;
            margin-bottom: .1835837rem;
            padding-top: .8164163rem
        }

        h3 {
            font-size: 1.6457143rem;
            margin-bottom: .07599rem;
            padding-top: .92401rem
        }

        h4 {
            font-size: 1.5625rem;
            margin-bottom: .546865rem;
            padding-top: .453135rem
        }

        h5 {
            font-size: 1.25rem;
            margin-bottom: -.56251rem;
            padding-top: .56251rem
        }

        h6 {
            font-size: 1rem;
            margin-bottom: -.65001rem;
            padding-top: .65001rem
        }

        .g {
            margin-left: -16px;
            margin-right: -16px
        }

        .g-b {
            padding-left: 16px;
            padding-right: 16px
        }

        .g-b--d1of1 {
            width: 100%
        }

        .g-b--d1of2, .g-b--d2of4, .g-b--d3of6, .g-b--d4of8, .g-b--d5of10, .g-b--d6of12 {
            width: 50%
        }

        .g-b--d1of3, .g-b--d2of6, .g-b--d4of12 {
            width: 33.333%
        }

        .g-b--d2of3, .g-b--d4of6, .g-b--d8of12 {
            width: 66.666%
        }

        .g-b--d1of4, .g-b--d2of8, .g-b--d3of12 {
            width: 25%
        }

        .g-b--d3of4, .g-b--d6of8, .g-b--d9of12 {
            width: 75%
        }

        .g-b--d1of5, .g-b--d2of10 {
            width: 20%
        }

        .g-b--d2of5, .g-b--d4of10 {
            width: 40%
        }

        .g-b--d3of5, .g-b--d6of10 {
            width: 60%
        }

        .g-b--d4of5, .g-b--d8of10 {
            width: 80%
        }

        .g-b--d1of6, .g-b--d2of12 {
            width: 16.666%
        }

        .g-b--d5of6, .g-b--d10of12 {
            width: 83.333%
        }

        .g-b--d1of8 {
            width: 12.5%
        }

        .g-b--d3of8 {
            width: 37.5%
        }

        .g-b--d5of8 {
            width: 62.5%
        }

        .g-b--d7of8 {
            width: 87.5%
        }

        .g-b--d1of10 {
            width: 10%
        }

        .g-b--d3of10 {
            width: 30%
        }

        .g-b--d7of10 {
            width: 70%
        }

        .g-b--d9of10 {
            width: 90%
        }

        .g-b--d1of12 {
            width: 8.333%
        }

        .g-b--d5of12 {
            width: 41.666%
        }

        .g-b--d7of12 {
            width: 58.333%
        }

        .g-b--d11of12 {
            width: 91.666%
        }

        .g-b--push--d1of1 {
            margin-left: 100%
        }

        .g-b--push--d1of2, .g-b--push--d2of4, .g-b--push--d3of6, .g-b--push--d4of8, .g-b--push--d5of10, .g-b--push--d6of12 {
            margin-left: 50%
        }

        .g-b--push--d1of3, .g-b--push--d2of6, .g-b--push--d4of12 {
            margin-left: 33.333%
        }

        .g-b--push--d2of3, .g-b--push--d4of6, .g-b--push--d8of12 {
            margin-left: 66.666%
        }

        .g-b--push--d1of4, .g-b--push--d2of8, .g-b--push--d3of12 {
            margin-left: 25%
        }

        .g-b--push--d3of4, .g-b--push--d6of8, .g-b--push--d9of12 {
            margin-left: 75%
        }

        .g-b--push--d1of5, .g-b--push--d2of10 {
            margin-left: 20%
        }

        .g-b--push--d2of5, .g-b--push--d4of10 {
            margin-left: 40%
        }

        .g-b--push--d3of5, .g-b--push--d6of10 {
            margin-left: 60%
        }

        .g-b--push--d4of5, .g-b--push--d8of10 {
            margin-left: 80%
        }

        .g-b--push--d1of6, .g-b--push--d2of12 {
            margin-left: 16.666%
        }

        .g-b--push--d5of6, .g-b--push--d10of12 {
            margin-left: 83.333%
        }

        .g-b--push--d1of8 {
            margin-left: 12.5%
        }

        .g-b--push--d3of8 {
            margin-left: 37.5%
        }

        .g-b--push--d5of8 {
            margin-left: 62.5%
        }

        .g-b--push--d7of8 {
            margin-left: 87.5%
        }

        .g-b--push--d1of10 {
            margin-left: 10%
        }

        .g-b--push--d3of10 {
            margin-left: 30%
        }

        .g-b--push--d7of10 {
            margin-left: 70%
        }

        .g-b--push--d9of10 {
            margin-left: 90%
        }

        .g-b--push--d1of12 {
            margin-left: 8.333%
        }

        .g-b--push--d5of12 {
            margin-left: 41.666%
        }

        .g-b--push--d7of12 {
            margin-left: 58.333%
        }

        .g-b--push--d11of12 {
            margin-left: 91.666%
        }

        .g-b--pull--d1of1 {
            margin-right: 100%
        }

        .g-b--pull--d1of2, .g-b--pull--d2of4, .g-b--pull--d3of6, .g-b--pull--d4of8, .g-b--pull--d5of10, .g-b--pull--d6of12 {
            margin-right: 50%
        }

        .g-b--pull--d1of3, .g-b--pull--d2of6, .g-b--pull--d4of12 {
            margin-right: 33.333%
        }

        .g-b--pull--d2of3, .g-b--pull--d4of6, .g-b--pull--d8of12 {
            margin-right: 66.666%
        }

        .g-b--pull--d1of4, .g-b--pull--d2of8, .g-b--pull--d3of12 {
            margin-right: 25%
        }

        .g-b--pull--d3of4, .g-b--pull--d6of8, .g-b--pull--d9of12 {
            margin-right: 75%
        }

        .g-b--pull--d1of5, .g-b--pull--d2of10 {
            margin-right: 20%
        }

        .g-b--pull--d2of5, .g-b--pull--d4of10 {
            margin-right: 40%
        }

        .g-b--pull--d3of5, .g-b--pull--d6of10 {
            margin-right: 60%
        }

        .g-b--pull--d4of5, .g-b--pull--d8of10 {
            margin-right: 80%
        }

        .g-b--pull--d1of6, .g-b--pull--d2of12 {
            margin-right: 16.666%
        }

        .g-b--pull--d5of6, .g-b--pull--d10of12 {
            margin-right: 83.333%
        }

        .g-b--pull--d1of8 {
            margin-right: 12.5%
        }

        .g-b--pull--d3of8 {
            margin-right: 37.5%
        }

        .g-b--pull--d5of8 {
            margin-right: 62.5%
        }

        .g-b--pull--d7of8 {
            margin-right: 87.5%
        }

        .g-b--pull--d1of10 {
            margin-right: 10%
        }

        .g-b--pull--d3of10 {
            margin-right: 30%
        }

        .g-b--pull--d7of10 {
            margin-right: 70%
        }

        .g-b--pull--d9of10 {
            margin-right: 90%
        }

        .g-b--pull--d1of12 {
            margin-right: 8.333%
        }

        .g-b--pull--d5of12 {
            margin-right: 41.666%
        }

        .g-b--pull--d7of12 {
            margin-right: 58.333%
        }

        .g-b--pull--d11of12 {
            margin-right: 91.666%
        }

        .splashscreen-dillinger {
            width: 700px
        }

        .splashscreen p {
            font-size: 1.25rem;
            margin-bottom: 1.43749rem;
            padding-top: .56251rem
        }

        .title {
            font-size: .8rem;
            margin-bottom: .77999rem;
            padding-top: .22001rem
        }

        .title-document {
            font-size: 1.25rem;
            margin-bottom: .89999rem;
            padding-top: .10001rem
        }

        .menu .menu-item--export-as {
            display: block
        }

        .menu .menu-item--preview {
            display: none
        }

        .settings a {
            font-size: 1.25rem
        }

        .words {
            font-size: .8rem;
            margin-bottom: .77999rem;
            padding-top: .22001rem
        }

        .modal--dillinger.about .modal-dialog, #zen {
            font-size: 1.25rem
        }

        #zen {
            width: 700px
        }

        #editor {
            font-size: 1rem
        }
    }

    @media screen and (min-width: 87.5em) {
        html {
            font-size: .875em
        }

        body {
            font-size: 1rem
        }

        ul, ol {
            margin-bottom: .83999rem;
            padding-top: .16001rem
        }

        p {
            padding-top: .66001rem
        }

        p, pre {
            margin-bottom: 1.33999rem
        }

        pre, blockquote p {
            font-size: 1rem;
            padding-top: .66001rem
        }

        blockquote p {
            margin-bottom: .33999rem
        }

        h1 {
            font-size: 2.0571429rem;
            margin-bottom: .21999rem;
            padding-top: .78001rem
        }

        h2 {
            font-size: 1.953125rem;
            margin-bottom: .1835837rem;
            padding-top: .8164163rem
        }

        h3 {
            font-size: 1.6457143rem;
            margin-bottom: .07599rem;
            padding-top: .92401rem
        }

        h4 {
            font-size: 1.5625rem;
            margin-bottom: .546865rem;
            padding-top: .453135rem
        }

        h5 {
            font-size: 1.25rem;
            margin-bottom: -.56251rem;
            padding-top: .56251rem
        }

        h6 {
            font-size: 1rem;
            margin-bottom: -.65001rem;
            padding-top: .65001rem
        }

        .splashscreen-dillinger {
            width: 800px
        }

        .splashscreen p {
            font-size: 1.25rem;
            margin-bottom: 1.43749rem;
            padding-top: .56251rem
        }

        .title {
            font-size: .8rem;
            margin-bottom: .77999rem;
            padding-top: .22001rem
        }

        .title-document {
            margin-bottom: .89999rem;
            padding-top: .10001rem
        }

        .title-document, .settings a {
            font-size: 1.25rem
        }

        .words {
            font-size: .8rem;
            margin-bottom: .77999rem;
            padding-top: .22001rem
        }

        .modal--dillinger.about .modal-dialog, #zen {
            font-size: 1.25rem
        }

        #editor {
            font-size: 1rem
        }
    }

    @media screen and (max-width: 46.1875em) {
        .editor-header {
            display: none
        }

        .editor-header--first {
            display: block;
            width: 100%
        }
    }</style>
</head>
<body id="preview">
<h1><a id="JavaEE_with_MongoDB_and_Morphia_0"></a>JavaEE with MongoDB and Morphia</h1>
<p>by Ulrich Cech</p>
<h2><a id="Einleitung_3"></a>Einleitung</h2>
<p>MongoDB is an open-source, document database designed for ease of development and scaling.
    I dont want to recap all the key features of MongoDB here, must of the readers perhaps always know MongoDB, but for
    the one, who dont know anything about MongoDB, I suggest a shot introduction from the official
    MongoDB-documentation
    found here: <a
            href="https://docs.mongodb.com/manual/introduction/">https://docs.mongodb.com/manual/introduction/</a></p>
<p>There are already many articles and tutorials about the MongoDB-Java-Driver, but in this article, I want to step a
    bit
    further and show, how to basically design and implement a JavaEE Web-Application with MongoDB.
    For the persistence layer, we will use Morphia as an entity-mapper, which as very closely designed to the
    JPA-standard
    (you will be familiar with several annotation names).</p>
<p>I dont want to show the typical Hello world-examples. I want to show you real-world scenarios, especially in case
    of
    the business objects. In addition, I want to build an architecture, that you can adopt 1-on-1 to real and productive
    business applications. For that, we want to implement a simple ordering-system which has users, products and orders.
    You will find the complete source code on my GitHub-account:
    <a href="https://github.com/UlrichCech/javaee-mongo-morphia">https://github.com/UlrichCech/javaee-mongo-morphia</a>
    (use the GIT-Tag <strong><code>part_1</code></strong>)</p>
<p>The only requirement is a current IDE with a configured JavaEE7-conform server (like Payara, Glassfish, Wildfly).
    I personally prefer Payara, because it is based on the reference implementation for JavaEE, namely Glassfish,
    and the Payara-team takes a lot of effort to extend it, update the libraries and make bugfixes with a quarterly
    update-cycle. If you look at the Github-repository of the Payara-team
    <a href="https://github.com/payara">https://github.com/payara</a>, you see plenty of commits (I think, they work 24
    hours a day :-)).</p>
<h2><a id="Motivation_28"></a>Motivation</h2>
<p>Especially with new projects you want to be productive quickly and achieve fast results. Traditionally in a
    JavaEE-environment, you will use JPA in the persistence layer, combined with a relational database.
    I will demonstrate how well MongoDB integrates into a JavaEE environment in conjunction with Morphia.
    It is intended to go especially to a certain elegance and simplicity of the technologies.</p>
<p>Typically, a SQL database server must be installed and configured, then you have to deal with the configuration of
    the Datasource and finally you must establish the connection via the persistence.xml in the application.</p>
<p>In your traditional JavaEE-application design, you start to consider, how the business entities can be mapped to the
    individual tables and how their relationships are modeled.
    And exactly at this point, the problems get started, because a good domain driven design is very difficult to map
    to the relational model.
    Due to the distribution of data across a number of tables that are somewhat related (relational database model)
    we must always deal and think of transaction, because every update to the data involves always multiple tables,
    which must be updated in parallel. And there is a potential possibility, that another client wants to update a part
    of the same data at the same time.</p>
<p>MongoDB goes one step further and does not offer transactions because transactions in most cases are actually not
    needed and are mainly needed in the relational world because of the distribution of data across multiple tables.
    But in MongoDB we have a single document (perhaps with embedded sub-documents), which is considered as a complete
    unit and is persisted as this complete unit in one collection.
    So it cannot happen that an embedded sub-document (which would be stored in a relational model in another table),
    is used or updated by another process or user. There would be always the complete document, which is handled and
    updated as a unit and always the complete document will be saved or updated in the collection.
    So, the document itself is always consistent. This makes the developers life much easier.
    Of course, different users can access or update one document as a whole in parallel, but the document will always be
    consistent and updated in a consistent way.
    If there is a conflict (because the current document is meanwhile updated by an other user), this situation can be
    identified via a special field of the entity, which is annotated with
    <code>@org.mongodb.morphia.annotations.Version</code>.
    It is the same behaviour as with JPA and provides a kind of optimistic locking.
    This conflict must be handled by the application, and the same is true for the relational model.
    But with the document centric approach, the possibility for a conflict is minimized and much easier to handle then
    in
    the old relational world.</p>
<p>But sometimes, you really need the concept of a transaction. Then you can stick with the so called Two phase
    commit,
    which is described in very detail here:
    <a href="https://docs.mongodb.com/manual/tutorial/perform-two-phase-commits/">https://docs.mongodb.com/manual/tutorial/perform-two-phase-commits/</a>
</p>
<h2><a id="DomainDrivenDesign_68"></a>Domain-Driven-Design</h2>
<p>Basically the Domain Driven Design is understood to provide the business domain stand in the foreground.
    Until now, we always almost did quite some work with normalizing the database to reduce data duplication.</p>
<p><strong>Example:</strong> A user has properties like a lastname, a firstname, age, username, password, birthdate.
    Mostly, the user
    has an address, too. And in a shop system, he needs a credit card or a bank account to make an order.
    If we use normalization, it will look like this:
    User  Address
    User  paymentMethod  All-PaymentMethods</p>
<p>Lets go one step further. In a shop system, every user has 0-n orders with 1-n articles/products:</p>
<p>User  Order  orderedArticles  articles</p>
<p>Between orders and articles, we have a m:n-relation, one order can have multiple articles, and one article can be
    chosen in many orders. So in the relational model, we need 3 tables here.</p>
<p>In a real shop-application, we cannot do this with a complete normalized database concept because if we only refer
    to the article, any change to the price of this article would be used for every reference. So if we want to know the
    total sum of a specific recent order, we will get different result with every change to a price of an article.
    We would always get the current price, not the price, when the user ordered this article.
    So, at this point, we have to break the normalization and store the price at the time of the order. Normally, we
    need
    to store the description as well to the order, so that in case of some complaint, we need to see the conditions for
    this article exactly to the time of the order. So we must store information redundantly for traceability and embed
    the articles to the order. When we embed these articles, the fields of the articles are copied into the order
    table
    or into a corresponding table of ordered articles, when we model a 1:n-relation like this:
    Order -&gt; OrderedArticles</p>
<p>Another option could be to store only the changes, which are made at the article, as a kind of history, and if we
    need
    the state of the article to a special time, you have to reconstruct it with the information of the historical
    changes.
    But such history is not trivial to implement, especially with hierarchical structured entity.</p>
<p>Ok, lets look at the implementation for the order process. We have to store information to several tables, which
    of course must be done in a transactional way in order to have a consistent state of our order.
    It makes no sense to store the main order information but without the ordered articles. So all tables have to be
    updates/inserted together.</p>
<p>But, if we now look at the domain-model, it would know nothing of the various tables. It is one object with a list
    of ordered articles and the user, who has ordered these articles. This business object of such an order could be
    modelled as:</p>
<pre><code class="language-java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span
        class="hljs-title">Order</span> </span>{
   <span class="hljs-keyword">private</span> String orderNo;
   <span class="hljs-keyword">private</span> Date orderDate;
   <span class="hljs-keyword">private</span> User user;
   <span class="hljs-keyword">private</span> List&lt;Article&gt; articles;

   <span class="hljs-function"><span class="hljs-keyword">public</span> BigDecimal <span class="hljs-title">calculatePrice</span><span
           class="hljs-params">()</span> </span>{
       BigDecimal sum = BigDecimal.ZERO;
       <span class="hljs-keyword">for</span> (Article article : articles) {
           sum.add(article.getBruttoPrice());
       }
   }
}
</code></pre>
<pre><code class="language-java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span
        class="hljs-title">Article</span> </span>{
    <span class="hljs-keyword">private</span> BigDecimal price;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">double</span> vat;

    <span class="hljs-function"><span class="hljs-keyword">public</span> BigDecimal <span class="hljs-title">getBruttoPrice</span><span
            class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> calculate brutto;</span>
    }
}
</code></pre>
<p>This looks very similar to the JPA-structure, but we will see the the main difference or the advantage of MongoDB
    a bit later. In JPA, we would probably use <code>@ManyToOne</code> for the reference to the user, and an <code>@Embedded</code>
    fr the
    list of articles.</p>
<p>The attentive reader will have noticed, that there is a business method, namely the <code>calculatePrice()</code>
    method in the
    <code>Order</code> class. A classical JPA-object is usually an anaemic data container, a DTO with properties and
    only
    getter- and setter-methods.
    In a domain driven design, there are mostly rich-domain objects. Rich in term of having additional business
    specific
    methods. In our example, the order knows best about its total price. So the method for calculating this total price
    would go into the `Order class. You can image, what other methods could also go here, perhaps calculating taxes or
    something like this.</p>
<p>In the typical and classical JPA-way, you would model the Order-object the following way:</p>
<pre><code class="language-java"><span class="hljs-annotation">@javax</span>.persistence.Entity
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Order</span> </span>{
   <span class="hljs-keyword">private</span> String orderNo;

   <span class="hljs-annotation">@Temporal</span>(TemporalType.Date)
   <span class="hljs-keyword">private</span> Date orderDate;

   <span class="hljs-annotation">@javax</span>.persistence.Embedded
   <span class="hljs-keyword">private</span> de.sofiworx.examples.jmm.business.user.entity.Address address;

   <span class="hljs-annotation">@OneToMany</span>
   <span class="hljs-keyword">private</span> List&lt;OrderedArtikel&gt; articles;

   <span class="hljs-comment">// getter and setter</span>
}
</code></pre>
<p>Here we see the next big disadvantage of the relational database model:
    If we embed objects (in our case the address-object) and we change the address object (eg. add a new field), we
    always
    have to make a schema update. If we embed an <code>@Entity</code> we must update two tables, namely the table of the
    Entity and
    the table, where we embed this entity as well.
    MongoDB is schema-less, and thats a big advantage and give us a great performance hit through better productivity,
    because we do not have to make updates to the database, if we add some field to an object.</p>
<p><strong>In summary:</strong> in the embedded scenario, where we want to add <em>one</em> more field to the embedded
    object, we need <em>two</em>
    schema updates to the relational database. Very un-productive, isnt it? in MongoDB, we do not need an update at
    all.
    Sure, it needs a bit of careful development here, because you dont want to deal with a hugh amount of different
    object versions, which all will have different amount of property. This would be a nightmare in the application
    code
    to handle every version of our entities.
    But if you have this in mind, the schema-less paradigm is a hugh productivity goal.</p>
<p>After this short introduction, we want to get started hacking.
    First, we will install our MongoDB, start the <strong>mongod</strong>-process (thats the MongoDB server deamon) and
    then we want
    to persist our first object into MongoDB.
    Lets go with hands-on-doing.</p>
<h2><a id="Setup_a_MongoDB_database_server_192"></a>Setup a MongoDB database server</h2>
<p>The first main advantage of MongoDB is its easy setup. There is no complicated installation process, just download
    the archive file, extract it and start the database-deamon:</p>
<ol>
    <li>Download the newest MongoDB from
        <a href="https://www.mongodb.org/downloads#production">https://www.mongodb.org/downloads#production</a>
        <ul>
            <li>use the archive file appropriate for your operating system</li>
        </ul>
    </li>
    <li>Extract the file to directory, e.g. <code>/work/database/mongodb</code></li>
    <li>create the data directory <code>mkdir /work/database/mongodb/data</code></li>
    <li>on to the commandline type: <code>/work/database/mongodb/mongod -dbpath=data</code>
        Thats it. Now you have a MongoDB server running, on localhost with port 27017 (this is MongoDB-default).
    </li>
</ol>
<p>I will omit dealing with the Mongo-Client in Terminal window, create databases and collections and so on. Please
    refer
    to the official documentation of MongoDB and their tutorials for further information:
    <a href="https://docs.mongodb.com/manual/">https://docs.mongodb.com/manual/</a></p>
<p>Now, that we have the MongoDB-Server running, we want to connect to it from our application. So it is time to setup
    our application and start coding.</p>
<p>We will start with a plain and clean Maven project, which can be used in every IDE of your choice. Start a new
    Maven-Project and use the following pom.xml:</p>
<pre><code class="language-xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">project</span> <span class="hljs-attribute">xmlns</span>=<span
        class="hljs-value">"http://maven.apache.org/POM/4.0.0"</span>
         <span class="hljs-attribute">xmlns:xsi</span>=<span class="hljs-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="hljs-attribute">xsi:schemaLocation</span>=<span class="hljs-value">"http://maven.apache.org/POM/4.0.0
                             http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">modelVersion</span>&gt;</span>4.0.0<span
            class="hljs-tag">&lt;/<span class="hljs-title">modelVersion</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>de.sofiworx.examples<span
            class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>javaee-mongo-morphia<span
            class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span
            class="hljs-title">version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">packaging</span>&gt;</span>war<span class="hljs-tag">&lt;/<span
            class="hljs-title">packaging</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">properties</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">maven.compiler.source</span>&gt;</span>1.8<span
            class="hljs-tag">&lt;/<span class="hljs-title">maven.compiler.source</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">maven.compiler.target</span>&gt;</span>1.8<span
            class="hljs-tag">&lt;/<span class="hljs-title">maven.compiler.target</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">failOnMissingWebXml</span>&gt;</span>false<span
            class="hljs-tag">&lt;/<span class="hljs-title">failOnMissingWebXml</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">project.build.sourceEncoding</span>&gt;</span>UTF-8<span
            class="hljs-tag">&lt;/<span class="hljs-title">project.build.sourceEncoding</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span
            class="hljs-tag">&lt;/<span class="hljs-title">project.reporting.outputEncoding</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">properties</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">dependencies</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>javax<span class="hljs-tag">&lt;/<span
            class="hljs-title">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>javaee-api<span
            class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>7.0<span class="hljs-tag">&lt;/<span
            class="hljs-title">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span
            class="hljs-title">scope</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span
            class="hljs-title">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span
            class="hljs-title">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>4.12<span class="hljs-tag">&lt;/<span
            class="hljs-title">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">scope</span>&gt;</span>test<span
            class="hljs-tag">&lt;/<span class="hljs-title">scope</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">dependencies</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">build</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">finalName</span>&gt;</span>javaee-mongo-morphia<span
            class="hljs-tag">&lt;/<span class="hljs-title">finalName</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">resources</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">resource</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">directory</span>&gt;</span>src/main/resources<span
            class="hljs-tag">&lt;/<span class="hljs-title">directory</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">excludes</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">exclude</span>&gt;</span>assemblies/**<span
            class="hljs-tag">&lt;/<span class="hljs-title">exclude</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">excludes</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">filtering</span>&gt;</span>true<span
            class="hljs-tag">&lt;/<span class="hljs-title">filtering</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">resource</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">resources</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">plugins</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">plugin</span>&gt;</span>
                <span class="hljs-tag">&lt;<span
                        class="hljs-title">artifactId</span>&gt;</span>maven-compiler-plugin<span class="hljs-tag">&lt;/<span
            class="hljs-title">artifactId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>3.1<span class="hljs-tag">&lt;/<span
            class="hljs-title">version</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">configuration</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">source</span>&gt;</span>${maven.compiler.source}<span
            class="hljs-tag">&lt;/<span class="hljs-title">source</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">target</span>&gt;</span>${maven.compiler.target}<span
            class="hljs-tag">&lt;/<span class="hljs-title">target</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">compilerVersion</span>&gt;</span>${maven.compiler.source}<span
            class="hljs-tag">&lt;/<span class="hljs-title">compilerVersion</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">encoding</span>&gt;</span>UTF-8<span
            class="hljs-tag">&lt;/<span class="hljs-title">encoding</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">configuration</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">plugin</span>&gt;</span>
                <span class="hljs-tag">&lt;<span
                        class="hljs-title">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span
            class="hljs-title">groupId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>maven-war-plugin<span
            class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>2.6<span class="hljs-tag">&lt;/<span
            class="hljs-title">version</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">configuration</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">failOnMissingWebXml</span>&gt;</span>false<span
            class="hljs-tag">&lt;/<span class="hljs-title">failOnMissingWebXml</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">configuration</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">plugin</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">plugins</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">build</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">project</span>&gt;</span>
</code></pre>
<p>We only need dependency for JavaEE, for sure, and provide some basic plugins for compiling and building a
    WAR-file.</p>
<p>For connecting to MongoDB and using Morphia as an object-mapper, we need two more dependencies.
    The first one is the dependency for the MongoDB-Java-Driver and the second one is Morphia:</p>
<pre><code class="language-xml">...
<span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.mongodb<span class="hljs-tag">&lt;/<span
            class="hljs-title">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>mongo-java-driver<span
            class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>3.2.2<span class="hljs-tag">&lt;/<span
            class="hljs-title">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.mongodb.morphia<span
            class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>morphia<span
            class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>1.2.0<span class="hljs-tag">&lt;/<span
            class="hljs-title">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>
...
</code></pre>
<p>For the implementation, first we need a connection to our database. This connection is provided by the
    MongoDB-Java-Driver, which is comparable with the JDBC-driver.
    You can find more about the MongoDB Java Driver here:
    <a href="https://github.com/mongodb/mongo-java-driver">https://github.com/mongodb/mongo-java-driver</a>
    But we neither use JPA nor some kind of Datasources and no persistence.xml, we implement our EntityManager
    on our own:</p>
<pre><code class="language-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span
        class="hljs-keyword">class</span> <span class="hljs-title">DBConnection</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> MongoClient mongo;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span
            class="hljs-title">DBConnection</span><span class="hljs-params">()</span> </span>{
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span
            class="hljs-title">init</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span> (mongo == <span class="hljs-keyword">null</span>) {
            mongo = <span class="hljs-keyword">new</span> MongoClient(<span
            class="hljs-string">"localhost"</span>, <span class="hljs-number">27017</span>);
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span
            class="hljs-title">closeConnection</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span> (mongo != <span class="hljs-keyword">null</span>) {
            mongo.close();
            mongo = <span class="hljs-keyword">null</span>;
        }
    }
}
</code></pre>
<p>If we instantiate the <code>DBConnection</code> class and call its <code>init()</code>-method, we see some log output
    like this:</p>
<pre><code>INFORMATION: Monitor thread successfully connected to server with description ServerDescription{address=localhost:27017,
 type=STANDALONE, state=CONNECTED, ok=true, version=ServerVersion{versionList=[3, 2, 6]}, minWireVersion=0, maxWireVersion=4,
 maxDocumentSize=16777216, roundTripTimeNanos=1514197}
</code></pre>
<p>=&gt; Now we have a client connection to our MongoDB database.</p>
<p>Ok, we extend our example and want to persist our first object. For that, we use a simple and small JUnit-test case,
    where we implement the persisting of an object into the database:</p>
<pre><code class="language-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span
        class="hljs-keyword">class</span> <span class="hljs-title">DBConnectionTest</span> </span>{

    <span class="hljs-annotation">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span
            class="hljs-title">persistSimpleDocument</span><span class="hljs-params">()</span> </span>{
        DBConnection dbConnection = <span class="hljs-keyword">new</span> DBConnection();
        dbConnection.init();
        <span class="hljs-keyword">final</span> MongoClient mongoClient = dbConnection.getMongoClient();
        <span class="hljs-keyword">final</span> MongoCollection&lt;Document&gt; testdataCollection =
                mongoClient.getDatabase(<span class="hljs-string">"jmm"</span>).getCollection(<span class="hljs-string">"testdata"</span>);
        <span class="hljs-keyword">try</span> {
            Document storeDocument = <span class="hljs-keyword">new</span> Document();
            storeDocument.put(<span class="hljs-string">"field1"</span>, <span class="hljs-string">"value1"</span>);
            storeDocument.put(<span class="hljs-string">"field2"</span>, <span class="hljs-string">"value2"</span>);
            storeDocument.put(<span class="hljs-string">"field3"</span>, <span class="hljs-string">"value3"</span>);
            testdataCollection.insertOne(storeDocument);
            assertThat(testdataCollection.count(), is(<span class="hljs-number">1L</span>));
            <span class="hljs-keyword">final</span> Document retrievedDocument =
                    mongoClient.getDatabase(<span class="hljs-string">"jmm"</span>).getCollection(<span
            class="hljs-string">"testdata"</span>)
                            .find().first();
            assertThat(retrievedDocument.containsKey(<span class="hljs-string">"field2"</span>), is(<span
            class="hljs-keyword">true</span>));
            System.out.println(retrievedDocument.toJson());
            testdataCollection.deleteOne(retrievedDocument);
            assertThat(testdataCollection.count(), is(<span class="hljs-number">0L</span>));
        } <span class="hljs-keyword">finally</span> {
             <span class="hljs-comment">// completely clear the collection after test-execution</span>
            testdataCollection.deleteMany(<span class="hljs-keyword">new</span> BsonDocument());
        }
    }
}
</code></pre>
<p>MongoDB has collections (which are somewhat comparable to the tables of a SQL database). Every entry in these
    collections is a document, and these documents consists of key-value-entries. A value can of course be again a
    document (then we name this a sub-documents), so we can model really complex and hierarchical objects,
    which are stored as one document into one collection.</p>
<p>Ok, in this example, we put one document into the database and retrieved one document, so we can compare these two
    documents for equality. The document is finally printed out in JSON-format and should look like:</p>
<pre><code class="language-json">{ "<span class="hljs-attribute">_id</span>" : <span class="hljs-value">{ "<span
        class="hljs-attribute">$oid</span>" : <span class="hljs-value"><span class="hljs-string">"57378c84ad595366d626540f"</span> </span>}</span>,
  "<span class="hljs-attribute">field1</span>" : <span class="hljs-value"><span
            class="hljs-string">"value1"</span></span>,
  "<span class="hljs-attribute">field2</span>" : <span class="hljs-value"><span
            class="hljs-string">"value2"</span></span>,
  "<span class="hljs-attribute">field3</span>" : <span class="hljs-value"><span class="hljs-string">"value3"</span>
</span>}
</code></pre>
<p>For more examples of the MongoDB-JavaDriver, please refer to the following quick-tour:
    <a href="http://mongodb.github.io/mongo-java-driver/3.0/driver/getting-started/quick-tour/">http://mongodb.github.io/mongo-java-driver/3.0/driver/getting-started/quick-tour/</a>
</p>
<h2><a id="Morphia_403"></a>Morphia</h2>
<p>The MongoDB-Java driver provides us a good interface to the MongoDB database. The key-value-structure can easily
    be mapped to a simple Java-Map, so we have a really good known paradigm at hand to work with MongoDB.</p>
<p>But, of course, we dont want to map every single property of our business objects on our own. We want to have some
    mapping tool or library, like an object-relational-mapper (ORM) in the JPA world. And here comes Morphia into
    play.</p>
<p>Morphia is a MongoDB object-document mapper, developed in Java. It is based on the MongoDB-Java Driver and has the
    big advantage, that it is officially supported by MongoDB, because MongoDB developers support the Morphia
    codebase.</p>
<ul>
    <li>You can find the website of Morphia here:
        <a href="https://mongodb.github.io/morphia/">https://mongodb.github.io/morphia/</a></li>
    <li>And the current latest documentation of Morphia is located at:
        <a href="http://mongodb.github.io/morphia/1.2/">http://mongodb.github.io/morphia/1.2/</a></li>
</ul>
<p><strong>Comment:</strong> Eclipselink and HibernateOGM provide some JPA-implementation for MongoDB. But in my
    opinion, these
    implementations are a bit away from real productive usage. It lacks mainly the multiple hierarchical structure,
    which
    MongoDB supports with the document-centric approach.</p>
<p>Ok, now I want to show you, how you can map your first entity with Morphia:</p>
<pre><code class="language-java"><span
        class="hljs-annotation">@org</span>.mongodb.morphia.annotations.Entity(value = <span
        class="hljs-string">"users"</span>, noClassnameStored = <span class="hljs-keyword">true</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span
            class="hljs-title">User</span> </span>{

    <span class="hljs-annotation">@org</span>.mongodb.morphia.annotations.Id
    <span class="hljs-keyword">private</span> org.bson.types.ObjectId id;
    <span class="hljs-keyword">private</span> String firstname;
    <span class="hljs-keyword">private</span> String lastname;
    <span class="hljs-keyword">private</span> Date birthdate;
    <span class="hljs-keyword">private</span> String email;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">User</span><span
            class="hljs-params">()</span> </span>{
    }


    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span
            class="hljs-title">getFullName</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.lastname + <span
            class="hljs-string">", "</span> + <span class="hljs-keyword">this</span>.firstname;
    }

    <span class="hljs-comment">// getter/setter/equals()/hashCode()</span>
}
</code></pre>
<p>You declare a persistent entity for Morphia with the <code>@Entity</code>-annotation, exactly the same like in JPA.
    The
    parameter value points to the collection in MongoDB, where these entities should be stored. By default, Morphia
    stores the fully qualified classname in the classname-field. This field is automatically added by Morphia and
    is used for mapping the MongoDB-document back to the Java-entity. This sounds reasonable, but the main drawback
    of this is, that refactorings in your code are not synchronized with the MongoDB-documents. So, if you move one
    entity to another package, Morphia is no longer able to map this entity correctly, because the stored classname
    does not longer match with your code.
    Or, we always have to do some migration and update the classname-field to the new one in every document of the
    collection in question. If this collection is very big, such updates are not possible in a production environment.
    So, we provide the annotation-parameter noClassnameStored with a value of true, so that the classname is not
    stored along with the document. Morphia has to do some more work to find out the right class for the correct
    mapping, but now we are more flexible and need not take care, that the classname of the entities is always in
    sync with the implementation.</p>
<p>Like each entity in JPA, every entity for Morphia and MongoDB needs a unique ID. MongoDB provides a very good concept
    of calculating a unique ID, namely an ObjectId (for more information on this topic, refer to
    <a href="https://docs.mongodb.com/manual/reference/method/ObjectId/">https://docs.mongodb.com/manual/reference/method/ObjectId/</a>).
    Morphia adopts this concept seamlessly. The only thing we have to do is to provide a property of type
    <code>org.bson.types.ObjectId</code> and annotate it with <code>@org.mongodb.morphia.annotations.Id</code>.
    Morphia will set this property transparently in background, when a new entity is persisted to MongoDB (we will see
    this later on) and fills it again transparently, when the entity is read back from MongoDB.</p>
<p>In order to persist this entity to MongoDB via Morphia-mapping, we must initialize Morphia. So, we extend our
    <code>DBConnection</code> class as follows:</p>
<pre><code class="language-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span
        class="hljs-keyword">class</span> <span class="hljs-title">DBConnection</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> MongoClient mongo;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> MongoClient mongo;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Datastore datastore;


    <span class="hljs-function"><span class="hljs-keyword">public</span> <span
            class="hljs-title">DBConnection</span><span class="hljs-params">()</span> </span>{
    }


    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span
            class="hljs-title">init</span><span class="hljs-params">()</span> </span>{
         <span class="hljs-keyword">if</span> ((mongo == <span class="hljs-keyword">null</span>) &amp;&amp; (datastore == <span
            class="hljs-keyword">null</span>)) {
             mongo = <span class="hljs-keyword">new</span> MongoClient(<span
            class="hljs-string">"localhost"</span>, <span class="hljs-number">27017</span>);
             Morphia morphia = <span class="hljs-keyword">new</span> Morphia();
             datastore = morphia.createDatastore(mongo, <span class="hljs-string">"jmm"</span>);
         }
     }

     <span class="hljs-function"><span class="hljs-keyword">public</span> Datastore <span class="hljs-title">getDatastore</span><span
             class="hljs-params">()</span> </span>{
         <span class="hljs-keyword">return</span> datastore;
     }

}
</code></pre>
<p>From now on, the <code>org.mongodb.morphia.Datastore</code> has the functionality of an EntityManager.
    We can use it, for example, in the following way (the easiest way again is to show it in a test case):</p>
<pre><code class="language-java"><span class="hljs-annotation">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span
        class="hljs-title">persistEntityWithMorphia</span><span class="hljs-params">()</span> </span>{
    DBConnection dbConnection = <span class="hljs-keyword">new</span> DBConnection();
    User testUser = <span class="hljs-keyword">new</span> User();
    <span class="hljs-keyword">try</span> {
        dbConnection.init();
        testUser.setFirstname(<span class="hljs-string">"Max"</span>);
        testUser.setLastname(<span class="hljs-string">"Mustermann"</span>);
        testUser.setBirthdate(<span class="hljs-keyword">new</span> GregorianCalendar(<span
            class="hljs-number">1974</span>, <span class="hljs-number">10</span>, <span
            class="hljs-number">12</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>).getTime());
        testUser.setEmail(<span class="hljs-string">"max.mustermann@example.com"</span>);
        dbConnection.getDatastore().save(testUser);
        assertThat(testUser.getId(), notNullValue());
        <span class="hljs-keyword">final</span> User retrievedUser =
                 dbConnection.getDatastore().find(User.class)
                         .filter(<span class="hljs-string">"firstname"</span>, <span class="hljs-string">"Max"</span>).get();
        assertThat(retrievedUser.getLastname(), is(<span class="hljs-string">"Mustermann"</span>));
        assertThat(testUser.getId(), is(retrievedUser.getId()));
    } <span class="hljs-keyword">finally</span> {
        dbConnection.getDatastore().delete(testUser);
    }
}
</code></pre>
<p>Our <code>DBConncetion</code> is instantiated as before. Morphia is initialized as well, completely transparently.
    The Datastore is available for further use via the <code>DBConnection.getDatastore()</code> method.
    Then we create our business object and set some properties.
    In the next step we pass this business entity to the <code>Datastore.save()</code> method, which takes care of it
    and
    persists our entity to the users collection in MongoDB.
    I want to point to the assert-statement for not null for the Id-property of the user after the save method.
    Here we see, that Morphia automatically stores the ObjectId, which was generated by MongoDB while saving the
    entity to the MongoDB-collection, to the <code>Id</code>-property of our entity.
    In the next step, we query our just persisted entity again from MongoDB. Here, we use the
    <code>Datastore.find()</code> method,
    where we provide the class as search-parameter and tell Morphia with this class, that we search for objects
    of the typ of this class. With this information at hand, Morphia knows, in which collection to search
    (it gets this information from the value-parameter of the <code>@Entity</code>-annotation).
    In addition, we provide a filter. In our case, we want to find all users, which have a firstname of Max. In this
    test, we know, that we will only get exactly one result, so that we can use the <code>Query.get()</code> method,
    which gives
    us exactly one User entity as the result.</p>
<p><strong>Comment:</strong> If we replace <code>Query.get()</code> with <code>Query.iterator()</code>, we get an
    iterator, exactly an <code>Iterator&lt;User&gt;</code>,
    and with this iterator, we can loop over the resulting collection of users.</p>
<p>Finally in our test case, we check, if we really have gotten the correct object from our query by comparing the
    unique
    ID properties.</p>
<p>In a real business application, every entity has several properties, which are only technical. This could be
    a timestamp, when this entity was initially created or when this entity was last changed. And the property for the
    last change must be updated with every call to <code>Datastore.save()</code>. But we do not want to take care of
    these
    technical properties in our business methods.
    Additionally, I bet, that you (and me of course, too) will forget to update such technical properties at some time.
    So, we want to handle these aspects somewhere in the background automatically as a cross-cutting-concern.
    For that, we define an abstract super-class, which all persistent entities have to extend:</p>
<pre><code class="language-java"><span class="hljs-keyword">public</span> <span
        class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span
        class="hljs-title">PersistentEntity</span> </span>{

    <span class="hljs-annotation">@org</span>.mongodb.morphia.annotations.Id
    <span class="hljs-keyword">private</span> ObjectId id;

    <span class="hljs-annotation">@org</span>.mongodb.morphia.annotations.Version
    <span class="hljs-keyword">private</span> Long version;

    <span class="hljs-annotation">@org</span>.mongodb.morphia.annotations.Property
    <span class="hljs-keyword">private</span> Date created;

    <span class="hljs-annotation">@org</span>.mongodb.morphia.annotations.Property
    <span class="hljs-keyword">private</span> Date lastUpdate;

    <span class="hljs-annotation">@PrePersist</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span
            class="hljs-title">prePersist</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span> (created == <span class="hljs-keyword">null</span>) {
            created = <span class="hljs-keyword">new</span> Date();
        }
        <span class="hljs-keyword">this</span>.lastUpdate = <span class="hljs-keyword">new</span> Date();
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> ObjectId <span
            class="hljs-title">getId</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-comment">// getter/setter/equals()/hashCode()</span>
}
</code></pre>
<p>It is very important here to annotate our properties, which we want to have mapped in our entities, with
    <code>@org.mongodb.morphia.annotations.Property</code>.
    In a class, which is annotated with <code>@Entity</code>, all properties are mapped automatically by default. But in
    our
    abstract superclass, which is not annotated with <code>@Entity</code>, we must tell Morphia, which properties we
    want to
    have mapped from such an abstract superclass.
    The attentive reader would have noticed, that I have added a field version which is annotated with
    <code>@Version</code>.
    This annotation works nearly the same as in JPA and takes care for an optimistic locking. When persisting the
    entity,
    Morphia looks first at the version field in the database, if it has the same value as in the object, which should
    currently be persisted. If it matches, everything is clear and the object is persisted. But if the value differs,
    Morphia knows, that some changes in between has occurred and rejects the persisting of this object.
    This field is automatically managed for you, you do not need to set a value here.</p>
<p>For the property id, I only provide a getter-method. This should prevent our entity, that the id property
    is set or overridden by accident through application code.</p>
<p>In the User-object, we can delete the <code>@Id</code>-property, because now we inherit from
    <code>PersistentEntity</code>.
    And after that we have the big advantage, that we only declare business properties in our business entities. All the
    technical aspects are in the background.</p>
<pre><code class="language-java"><span
        class="hljs-annotation">@org</span>.mongodb.morphia.annotations.Entity(value = <span
        class="hljs-string">"users"</span>, noClassnameStored = <span class="hljs-keyword">true</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span
            class="hljs-title">User</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">PersistentEntity</span> </span>{

    <span class="hljs-keyword">private</span> String firstname;
    <span class="hljs-keyword">private</span> String lastname;
    <span class="hljs-keyword">private</span> Date birthdate;
    <span class="hljs-keyword">private</span> String email;

    ...
}
</code></pre>
<p>If we now persist the entity with a call to <code>Datastore.save()</code>, the method with the annotaion <code>@PrePersist</code>
    is called
    first. In this method, we check, if we have a new entity or an existing/updated entity (in a new entity, the
    created property is null), and only in the case of a new entity, we set the created property with the current
    timestamp.
    The property lastUpdate should be set or updated with the current timestamp in any situation.</p>
<p>There are currently 5 lifecycle-methods, which are described here:
    <a href="https://github.com/mongodb/morphia/wiki/LifecycleMethods">https://github.com/mongodb/morphia/wiki/LifecycleMethods</a>
</p>
<ul>
    <li>@PreLoad</li>
    <li>@PostLoad</li>
    <li>@PrePersist</li>
    <li>@PreSave</li>
    <li>@PostPersist</li>
</ul>
<p>We extend our last test-case with</p>
<pre><code class="language-java">...
dbConnection.getDatastore().save(testUser);
assertThat(testUser.getId(), notNullValue());
assertThat(testUser.getCreated(), notNullValue());
assertThat(testUser.getLastUpdate(), notNullValue());
...
</code></pre>
<p>and see, that it is green ;-). The two timestamps created and lastUpdate are set without setting them explicitly
    in our test case code.</p>
<h2><a id="JavaEE_652"></a>JavaEE</h2>
<h3><a id="First_Strike_653"></a>First Strike</h3>
<p>I hear you shout out loud: Where on earth is the JavaEE-part coming?
    Ok, lets integrated that with JavaEE. I assume, you have a JavaEE7-compatible server configured, so that we can
    deploy
    our application to it.</p>
<p>First of all I want to show you the BCE-package structure. BCE stands for <em>B</em>oundary, <em>C</em>ontrol,
    <em>E</em>ntity. There
    is a nice short introduction video to this topic of Java Champion Adam Bien at
    <a href="https://www.youtube.com/watch?v=grJC6RFiB58">https://www.youtube.com/watch?v=grJC6RFiB58</a>.</p>
<p>This package-structure is perfect for Domain-Driven-Development, where every package-container (which consists of
    boundary, control and entity sub-package) is a part of the business domain.
    The boundary and control are both optional. In the boundary package, we put everything, which should be
    available
    to the outside-world for this business domain. For example, if we want to expose our list of users to an external
    system, we would provide a REST-service (eg. UsersResource), and this will go to the boundary package.</p>
<p>Everything, which is used inside of our application, for example, the list of users, which should be displayed on a
    web-page of our application, is implemented in a controller, which goes to the controller-package.</p>
<p>In our application, which we want to implement, there are users. So we need an entity, namely the User-class, and
    some functionality around the user (adding, deletion and so on). So we structure our user-package like this:</p>
<pre><code> de/sofiworx/examples/jmm/business/user/boundary
 de/sofiworx/examples/jmm/business/user/controller
   UserController.class
 de/sofiworx/examples/jmm/business/user/entity
   User.class
</code></pre>
<p>The <code>User</code> class goes to the entity-package, our <code>UserController</code> goes to the
    controller-package.
    Boundary can be avoided, I list it here only for clarification.</p>
<p>Ok, lets make our <code>DBConnection</code>-class a Singleton EJB. For that, we annotate the
    <code>DBConnection</code> class:</p>
<pre><code class="language-java"><span class="hljs-annotation">@javax</span>.ejb.Singleton
<span class="hljs-annotation">@javax</span>.ejb.Startup
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span
            class="hljs-title">DBConnection</span> </span>{
...
}
</code></pre>
<p>These two annotation make the EJB a singleton (<code>@Singleton</code>) and instantiate this class first when
    starting the
    application (<code>@Startup</code>).</p>
<p>In addition, we annotate our <code>DBConnection.init()</code>-method with <code>@PostConstruct</code>, so that the
    database connection
    is initialized automatically when the <code>DBConnection</code> class is instantiated:</p>
<pre><code class="language-java"><span class="hljs-annotation">@javax</span>.annotation.<span class="hljs-function">PostConstruct
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span
            class="hljs-title">init</span><span class="hljs-params">()</span> </span>{
    ....
}
</code></pre>
<p>Next, we annotate the <code>DBConnection.getDatastore()</code>-method with <code>@Produces</code>, so that we can
    inject the datastore in
    every managed bean (CDI, EJB).</p>
<p><strong>Attention:</strong> It is important here to use RequestScoped, because the Morphia-Datastore is currently
    not
    Serializable and an injection into Session or ViewScoped-beans leads to a Weld-Error while starting the application,
    because of injecting a non-serializable bean into a serializable bean.</p>
<pre><code class="language-java"> <span class="hljs-annotation">@javax</span>.enterprise.inject.Produces
 <span class="hljs-annotation">@javax</span>.enterprise.context.<span class="hljs-function">RequestScoped
 <span class="hljs-keyword">public</span> Datastore <span class="hljs-title">getDatastore</span><span
                class="hljs-params">()</span> </span>{
     <span class="hljs-keyword">return</span> datastore;
 }
</code></pre>
<p>A simple example for using the injected datastore is the <code>UserController</code>:</p>
<pre><code class="language-java"><span class="hljs-annotation">@javax</span>.enterprise.context.SessionScoped
<span class="hljs-annotation">@javax</span>.inject.Named
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span
            class="hljs-title">UserController</span> <span class="hljs-keyword">implements</span> <span
            class="hljs-title">Serializable</span> </span>{

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span
            class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = -<span
            class="hljs-number">6281169311696802773L</span>;

    <span class="hljs-annotation">@Inject</span>
    Datastore datastore;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span
            class="hljs-title">getCurrentAmountOfUsers</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> datastore.find(User.class).getCollection().getCount();
    }
}
</code></pre>
<p>We further need the typical JavaEE-WebApp Artifacts like <code>beans.xml</code>, <code>web.xml</code> and <code>faces-config.xml</code>
    (because our frontend will be based on JSF), which we will put into the ``src/main/webapp/WEB-INF` folder.</p>
<p><em>beans.xml</em></p>
<pre><code class="language-xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">beans</span> <span class="hljs-attribute">xmlns</span>=<span
        class="hljs-value">"http://xmlns.jcp.org/xml/ns/javaee"</span>
       <span class="hljs-attribute">xmlns:xsi</span>=<span class="hljs-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="hljs-attribute">xsi:schemaLocation</span>=<span class="hljs-value">"http://xmlns.jcp.org/xml/ns/javaee
                           http://xmlns.jcp.org/xml/ns/javaee/beans_1_1.xsd"</span>
       <span class="hljs-attribute">bean-discovery-mode</span>=<span class="hljs-value">"all"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">beans</span>&gt;</span>
</code></pre>
<p><em>web.xml:</em></p>
<pre><code class="language-xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">web-app</span> <span class="hljs-attribute">xmlns</span>=<span
        class="hljs-value">"http://xmlns.jcp.org/xml/ns/javaee"</span>
         <span class="hljs-attribute">xmlns:xsi</span>=<span class="hljs-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="hljs-attribute">xsi:schemaLocation</span>=<span class="hljs-value">"http://xmlns.jcp.org/xml/ns/javaee
                             http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"</span>
         <span class="hljs-attribute">version</span>=<span class="hljs-value">"3.1"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">context-param</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">param-name</span>&gt;</span>javax.faces.PROJECT_STAGE<span
            class="hljs-tag">&lt;/<span class="hljs-title">param-name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">param-value</span>&gt;</span>Development<span
            class="hljs-tag">&lt;/<span class="hljs-title">param-value</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">context-param</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">context-param</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">param-name</span>&gt;</span>javax.faces.INTERPRET_EMPTY_STRING_SUBMITTED_VALUES_AS_NULL<span
            class="hljs-tag">&lt;/<span class="hljs-title">param-name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">param-value</span>&gt;</span>true<span class="hljs-tag">&lt;/<span
            class="hljs-title">param-value</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">context-param</span>&gt;</span>


    <span class="hljs-tag">&lt;<span class="hljs-title">servlet</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">servlet-name</span>&gt;</span>Faces Servlet<span
            class="hljs-tag">&lt;/<span class="hljs-title">servlet-name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">servlet-class</span>&gt;</span>javax.faces.webapp.FacesServlet<span
            class="hljs-tag">&lt;/<span class="hljs-title">servlet-class</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">load-on-startup</span>&gt;</span>1<span class="hljs-tag">&lt;/<span
            class="hljs-title">load-on-startup</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">servlet</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">servlet-mapping</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">servlet-name</span>&gt;</span>Faces Servlet<span
            class="hljs-tag">&lt;/<span class="hljs-title">servlet-name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">url-pattern</span>&gt;</span>*.xhtml<span class="hljs-tag">&lt;/<span
            class="hljs-title">url-pattern</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">servlet-mapping</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">session-config</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">session-timeout</span>&gt;</span>30<span class="hljs-tag">&lt;/<span
            class="hljs-title">session-timeout</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">tracking-mode</span>&gt;</span>COOKIE<span class="hljs-tag">&lt;/<span
            class="hljs-title">tracking-mode</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">session-config</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">welcome-file-list</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">welcome-file</span>&gt;</span>index.xhtml<span
            class="hljs-tag">&lt;/<span class="hljs-title">welcome-file</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">welcome-file-list</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-title">web-app</span>&gt;</span>
</code></pre>
<p><em>faces-config.xml:</em></p>
<pre><code class="language-xml"><span class="hljs-pi">&lt;?xml version='1.0' encoding='UTF-8'?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">faces-config</span> <span
        class="hljs-attribute">version</span>=<span class="hljs-value">"2.2"</span>
              <span class="hljs-attribute">xmlns</span>=<span
            class="hljs-value">"http://xmlns.jcp.org/xml/ns/javaee"</span>
              <span class="hljs-attribute">xmlns:xsi</span>=<span class="hljs-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
              <span class="hljs-attribute">xsi:schemaLocation</span>=<span class="hljs-value">"http://xmlns.jcp.org/xml/ns/javaee
                                  http://xmlns.jcp.org/xml/ns/javaee/web-facesconfig_2_2.xsd"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">application</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">application</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">faces-config</span>&gt;</span>
</code></pre>
<p>Finally, we need the <code>index.xhtml</code> page, so that we can display our first message from our application:
</p>
<pre><code class="language-xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-doctype">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">html</span> <span class="hljs-attribute">xmlns</span>=<span
        class="hljs-value">"http://www.w3.org/1999/xhtml"</span>
      <span class="hljs-attribute">xmlns:h</span>=<span class="hljs-value">"http://xmlns.jcp.org/jsf/html"</span>
      <span class="hljs-attribute">xmlns:f</span>=<span
            class="hljs-value">"http://xmlns.jcp.org/jsf/core"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">f:view</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">h:body</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">h:outputText</span> <span
                    class="hljs-attribute">value</span>=<span class="hljs-value">"Hello from JavaEE with MongoDB. Currently, there are #{userController.getCurrentAmountOfUsers()} users in the database."</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">h:body</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">f:view</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span>
</code></pre>
<p>We see, that we use the <code>UserController</code>-class from above, where the datastore is injected, so that we
    have direct
    access to our database-layer.</p>
<p>If we deploy the application to our JavaEE7-server, start it and call the index-page in the browser, we should see
    something like this: <em>Hello from JavaEE with MongoDB. Currently, there are 0 users in the database.</em></p>
<p>You see the simplicity in initialization of the persistence-layer. It is one class (<code>DBConnection</code>), and
    we only need
    to inject the <code>Datastore</code>, where ever we need the persistence-layer. And because of the document-centric
    approach,
    we need not care about transactions in the first place. The complete document is stored at once.
    This is very helpful in case of complex data structures, which we will see later on.</p>
<p>If there is a conflict with concurrent access to the same entity, this is handled or better signalled by the
    <code>@Version</code> annotated field of our entities. If this situation occurs, a <code>java.util.ConcurrentModificationException</code>
    is thrown, which we need to handle according to the concrete business situation. It is not possible to handle this
    generically, because it depends really on the business use case.</p>
<p>There are situations, where a so called Two-face-commit is needed, and there is a detailed article from MongoDB
    about this topic and how to implement this. Here is the link to the article:
    <a href="https://docs.mongodb.com/v3.0/tutorial/perform-two-phase-commits/">https://docs.mongodb.com/v3.0/tutorial/perform-two-phase-commits/</a>
</p>
<p>And, of course, even if we use a JavaEE-environment, our persistence-tests can be performed without the use of a
    testing framework like Arquillian. We can just use plain JUnit-tests for that. We dont need complicated
    persistence.xml for tests with a different database configuration, perhaps a different dialect-setup or something
    like that. We only need a test MongoDB instance, ideally locally started to run our persistence-tests against.</p>
<p><strong>Comment:</strong> I will cover testing with MongoDB in a future article.</p>
<p>OK, now we want to extend our application to setup a page for user-management, where we see a list of our users,
    and where we can add and remove users to our system. For that, we extend our <code>User</code>-class:</p>
<pre><code class="language-java"><span
        class="hljs-annotation">@org</span>.mongodb.morphia.annotations.Entity(value = <span
        class="hljs-string">"users"</span>, noClassnameStored = <span class="hljs-keyword">true</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span
            class="hljs-title">User</span> </span>{

    <span class="hljs-keyword">private</span> String firstname;
    <span class="hljs-keyword">private</span> String lastname;
    <span class="hljs-keyword">private</span> Date birthdate;
    <span class="hljs-keyword">private</span> String email;

    <span class="hljs-annotation">@org</span>.mongodb.morphia.annotations.Embedded
    <span class="hljs-keyword">private</span> Address address;

    ...
}
</code></pre>
<pre><code class="language-java"><span class="hljs-annotation">@org</span>.mongodb.morphia.annotations.Embedded
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span
            class="hljs-title">Address</span> </span>{

    <span class="hljs-keyword">private</span> String street;
    <span class="hljs-keyword">private</span> String streetNo;
    <span class="hljs-keyword">private</span> String zipCode;
    <span class="hljs-keyword">private</span> String city;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Address</span><span
            class="hljs-params">()</span> </span>{
    }

    <span class="hljs-comment">// getter/setter/equals()/hashCode()</span>
}

</code></pre>
<p>Here, we define a so-called embeddable, which can be seen as sub-document. The MongoDB-document will later look like
    this, for example:</p>
<pre><code class="language-json">{
    "<span class="hljs-attribute">_id</span>" : <span class="hljs-value">ObjectId(<span class="hljs-string">"12345678909876543456"</span>)</span>,
    "<span class="hljs-attribute">firstname</span>" : <span class="hljs-value"><span class="hljs-string">"Bruce"</span></span>,
    "<span class="hljs-attribute">lastname</span>" : <span class="hljs-value"><span
            class="hljs-string">"Wayne"</span></span>,
    "<span class="hljs-attribute">birthdate</span>" : <span class="hljs-value"><span
            class="hljs-literal">null</span></span>,
    "<span class="hljs-attribute">email</span>" : <span class="hljs-value"><span
            class="hljs-string">"batman@gotham.org"</span></span>,
    "<span class="hljs-attribute">address</span>" : <span class="hljs-value">{
        "<span class="hljs-attribute">street</span>" : <span class="hljs-value"><span
                class="hljs-string">"Main Street"</span></span>,
        "<span class="hljs-attribute">streetNr</span>" : <span class="hljs-value"><span
                class="hljs-string">"1"</span></span>,
        "<span class="hljs-attribute">zipCode</span>" : <span class="hljs-value"><span
                class="hljs-string">"12345"</span></span>,
        "<span class="hljs-attribute">city</span>" : <span class="hljs-value"><span class="hljs-string">"Gotham"</span>
    </span>}
</span>}
</code></pre>
<p>Now, we extend the <code>UserController</code> for our JSF-page:</p>
<pre><code class="language-java"><span class="hljs-annotation">@javax</span>.enterprise.context.SessionScoped
<span class="hljs-annotation">@Named</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span
            class="hljs-title">UserController</span> <span class="hljs-keyword">implements</span> <span
            class="hljs-title">Serializable</span> </span>{

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span
            class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = -<span
            class="hljs-number">6281169311696802773L</span>;

    <span class="hljs-keyword">private</span> User userToAdd;

    <span class="hljs-keyword">private</span> List&lt;User&gt; usersToShow;

    <span class="hljs-keyword">private</span> String searchString;

    <span class="hljs-annotation">@Inject</span>
    <span class="hljs-annotation">@RequestScoped</span>
    <span class="hljs-keyword">private</span> Datastore datastore;


    <span class="hljs-function"><span class="hljs-keyword">public</span> <span
            class="hljs-title">UserController</span><span class="hljs-params">()</span> </span>{
    }

    <span class="hljs-annotation">@PostConstruct</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span
            class="hljs-title">init</span><span class="hljs-params">()</span> </span>{
        showAllUsers();
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span
            class="hljs-title">getCurrentAmountOfUsers</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> datastore.find(User.class).getCollection().getCount();
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span
            class="hljs-title">showAllUsers</span><span class="hljs-params">()</span> </span>{
        usersToShow = datastore.createQuery(User.class).order(<span class="hljs-string">"lastname,firstname"</span>).asList();
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span
            class="hljs-title">prepareNewUser</span><span class="hljs-params">()</span> </span>{
        userToAdd = <span class="hljs-keyword">new</span> User();
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span
            class="hljs-title">addNewUser</span><span class="hljs-params">()</span> </span>{
        datastore.save(userToAdd);
        userToAdd = <span class="hljs-keyword">null</span>;
        showAllUsers();
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span
            class="hljs-title">removeUser</span><span class="hljs-params">(User userToDelete)</span> </span>{
        datastore.delete(userToDelete);
        showAllUsers();
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span
            class="hljs-title">searchUsers</span><span class="hljs-params">(String stringToSearch)</span> </span>{
        <span class="hljs-keyword">final</span> Query&lt;User&gt; query = datastore.createQuery(User.class);
        <span class="hljs-keyword">if</span> (stringToSearch != <span class="hljs-keyword">null</span>) {
            query.or(query.criteria(<span class="hljs-string">"firstname"</span>).contains(stringToSearch),
                     query.criteria(<span class="hljs-string">"lastname"</span>).contains(stringToSearch));
        }
        usersToShow = query.asList();
    }

    <span class="hljs-annotation">@Produces</span>
    <span class="hljs-annotation">@Named</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span
            class="hljs-title">getUserToAdd</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> userToAdd;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title">getUsersToShow</span><span
            class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> usersToShow;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span
            class="hljs-title">getSearchString</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> searchString;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span
            class="hljs-title">setSearchString</span><span class="hljs-params">(String searchString)</span> </span>{
        <span class="hljs-keyword">this</span>.searchString = searchString;
    }
}
</code></pre>
<p>Then, we extend the <code>index.xhtml</code>:</p>
<pre><code class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-title">f:view</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">h:body</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">h:outputText</span> <span class="hljs-attribute">value</span>=<span
                        class="hljs-value">"Hello from JavaEE with MongoDB. Currently, there are #{userController.getCurrentAmountOfUsers()} user in the database."</span>/&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">h:link</span> <span
                        class="hljs-attribute">value</span>=<span class="hljs-value">"User-Management"</span> <span
                        class="hljs-attribute">outcome</span>=<span class="hljs-value">"users"</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">h:body</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">f:view</span>&gt;</span>
</code></pre>
<p>And finally the <code>users.xhtml</code>:</p>
<pre><code class="language-xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-doctype">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">html</span> <span class="hljs-attribute">xmlns</span>=<span
        class="hljs-value">"http://www.w3.org/1999/xhtml"</span>
      <span class="hljs-attribute">xmlns:h</span>=<span class="hljs-value">"http://xmlns.jcp.org/jsf/html"</span>
      <span class="hljs-attribute">xmlns:f</span>=<span
            class="hljs-value">"http://xmlns.jcp.org/jsf/core"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">f:view</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">h1</span>&gt;</span><span class="hljs-tag">&lt;<span
            class="hljs-title">h:outputLabel</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"Users"</span>/&gt;</span><span
            class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">h:panelGrid</span> <span
                class="hljs-attribute">columns</span>=<span class="hljs-value">"2"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">h:form</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">h:inputText</span> <span class="hljs-attribute">value</span>=<span
                        class="hljs-value">"#{userController.searchString}"</span> /&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">h:commandButton</span> <span class="hljs-attribute">value</span>=<span
                        class="hljs-value">"Search"</span>
                                 <span class="hljs-attribute">actionListener</span>=<span class="hljs-value">"#{userController.searchUsers(userController.searchString)}"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">f:ajax</span> <span class="hljs-attribute">execute</span>=<span
                            class="hljs-value">"@form"</span> <span class="hljs-attribute">render</span>=<span
                            class="hljs-value">"userListForm"</span> /&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">h:commandButton</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">h:form</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">h:panelGrid</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">h:form</span> <span class="hljs-attribute">id</span>=<span
                class="hljs-value">"userListForm"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">h:dataTable</span> <span
                    class="hljs-attribute">id</span>=<span class="hljs-value">"usersTable"</span> <span
                    class="hljs-attribute">value</span>=<span class="hljs-value">"#{userController.usersToShow}"</span>
                         <span class="hljs-attribute">var</span>=<span class="hljs-value">"user"</span> <span
                        class="hljs-attribute">style</span>=<span
                        class="hljs-value">"border: 1px solid;"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">h:column</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">f:facet</span> <span
                            class="hljs-attribute">name</span>=<span class="hljs-value">"header"</span>&gt;</span>
                        Lastname
                    <span class="hljs-tag">&lt;/<span class="hljs-title">f:facet</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">h:outputText</span> <span
                            class="hljs-attribute">value</span>=<span class="hljs-value">"#{user.lastname}"</span> /&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">h:column</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">h:column</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">f:facet</span> <span
                            class="hljs-attribute">name</span>=<span class="hljs-value">"header"</span>&gt;</span>
                        Firstname
                    <span class="hljs-tag">&lt;/<span class="hljs-title">f:facet</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">h:outputText</span> <span
                            class="hljs-attribute">value</span>=<span class="hljs-value">"#{user.firstname}"</span> /&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">h:column</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">h:column</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">f:facet</span> <span
                            class="hljs-attribute">name</span>=<span class="hljs-value">"header"</span>&gt;</span>
                        eMail
                    <span class="hljs-tag">&lt;/<span class="hljs-title">f:facet</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">h:outputText</span> <span
                            class="hljs-attribute">value</span>=<span
                            class="hljs-value">"#{user.email}"</span> /&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">h:column</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">h:column</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">f:facet</span> <span
                            class="hljs-attribute">name</span>=<span class="hljs-value">"header"</span>&gt;</span>
                        Birthdate
                    <span class="hljs-tag">&lt;/<span class="hljs-title">f:facet</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">h:outputText</span> <span
                            class="hljs-attribute">value</span>=<span class="hljs-value">"#{user.birthdate}"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-title">f:convertDateTime</span> <span
                                class="hljs-attribute">dateStyle</span>=<span class="hljs-value">"short"</span> <span
                                class="hljs-attribute">locale</span>=<span
                                class="hljs-value">"en-US"</span> /&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-title">h:outputText</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">h:column</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">h:column</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">h:commandButton</span> <span
                            class="hljs-attribute">value</span>=<span class="hljs-value">"Delete"</span>
                                     <span class="hljs-attribute">actionListener</span>=<span class="hljs-value">"#{userController.removeUser(user)}"</span> &gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-title">f:ajax</span> <span class="hljs-attribute">execute</span>=<span
                                class="hljs-value">"@this"</span> <span class="hljs-attribute">render</span>=<span
                                class="hljs-value">"usersTable"</span> /&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-title">h:commandButton</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">h:column</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">h:dataTable</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">h:form</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">h:panelGrid</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">h:form</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">h:commandButton</span> <span class="hljs-attribute">value</span>=<span
                        class="hljs-value">"New User"</span>
                                 <span class="hljs-attribute">actionListener</span>=<span class="hljs-value">"#{userController.prepareNewUser()}"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">f:ajax</span> <span class="hljs-attribute">execute</span>=<span
                            class="hljs-value">"@this"</span> <span class="hljs-attribute">render</span>=<span
                            class="hljs-value">"newUserGrid"</span> /&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">h:commandButton</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">h:form</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">h:panelGrid</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">h:panelGroup</span> <span
                class="hljs-attribute">id</span>=<span class="hljs-value">"newUserGrid"</span> <span
                class="hljs-attribute">rendered</span>=<span class="hljs-value">"#{not (userToAdd eq null)}"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">h:form</span> <span
                    class="hljs-attribute">id</span>=<span class="hljs-value">"newUserForm"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">h:panelGrid</span> <span class="hljs-attribute">columns</span>=<span
                        class="hljs-value">"2"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">h:outputLabel</span> <span
                            class="hljs-attribute">value</span>=<span class="hljs-value">"Firstname"</span> /&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">h:inputText</span> <span class="hljs-attribute">value</span>=<span
                            class="hljs-value">"#{userToAdd.firstname}"</span> /&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">h:outputLabel</span> <span
                            class="hljs-attribute">value</span>=<span class="hljs-value">"Lastname"</span> /&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">h:inputText</span> <span class="hljs-attribute">value</span>=<span
                            class="hljs-value">"#{userToAdd.lastname}"</span> /&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">h:outputLabel</span> <span
                            class="hljs-attribute">value</span>=<span class="hljs-value">"eMail"</span> /&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">h:inputText</span> <span class="hljs-attribute">value</span>=<span
                            class="hljs-value">"#{userToAdd.email}"</span> /&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">h:outputLabel</span> <span
                            class="hljs-attribute">value</span>=<span class="hljs-value">"Birthdate"</span> /&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">h:inputText</span> <span class="hljs-attribute">value</span>=<span
                            class="hljs-value">"#{userToAdd.birthdate}"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-title">f:convertDateTime</span> <span
                                class="hljs-attribute">type</span>=<span class="hljs-value">"date"</span> <span
                                class="hljs-attribute">pattern</span>=<span class="hljs-value">"MM.dd.yyyy"</span> <span
                                class="hljs-attribute">locale</span>=<span class="hljs-value">"en-US"</span>/&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-title">h:inputText</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">h:outputLabel</span> <span
                            class="hljs-attribute">value</span>=<span class="hljs-value">"Street"</span> /&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">h:inputText</span> <span class="hljs-attribute">value</span>=<span
                            class="hljs-value">"#{userToAdd.address.street}"</span> /&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">h:outputLabel</span> <span
                            class="hljs-attribute">value</span>=<span
                            class="hljs-value">"Street No."</span> /&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">h:inputText</span> <span class="hljs-attribute">value</span>=<span
                            class="hljs-value">"#{userToAdd.address.streetNo}"</span> /&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">h:outputLabel</span> <span
                            class="hljs-attribute">value</span>=<span class="hljs-value">"Zipcode"</span> /&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">h:inputText</span> <span class="hljs-attribute">value</span>=<span
                            class="hljs-value">"#{userToAdd.address.zipCode}"</span> /&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">h:outputLabel</span> <span
                            class="hljs-attribute">value</span>=<span class="hljs-value">"City"</span> /&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">h:inputText</span> <span class="hljs-attribute">value</span>=<span
                            class="hljs-value">"#{userToAdd.address.city}"</span> /&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">h:outputLabel</span> <span
                            class="hljs-attribute">value</span>=<span class="hljs-value">""</span> /&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">h:commandButton</span> <span
                            class="hljs-attribute">value</span>=<span class="hljs-value">"Add"</span> <span
                            class="hljs-attribute">action</span>=<span
                            class="hljs-value">"#{userController.addNewUser}"</span> /&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">h:panelGrid</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">h:form</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">h:panelGroup</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">f:view</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span>
</code></pre>
<p>Now we have a first running example with quite some functionality like searching (with using the Morphia-query),
    adding new users and deleting existing users.
    Not really much code, isnt it?</p>
<h3><a id="Extending_the_application_with_references_and_custom_typeconverter_1117"></a>Extending the application with
    references and custom type-converter</h3>
<p>In the next section, we will cover quite a lot of things at once.
    First, we see, how to map references to other entities, as well as the mapping of a list of embedded objects.
    Second, we will look at, how we can enhance Morphia with a custom type-converter. This is useful, if we have some
    entity-types, which are not the basic ones like String or Numbers. For example, the <code>BigDecimal</code>, which
    is quite
    important to store prices, cannot be instantiated by Morphia because of the missing default constructor in
    <code>BigDecimal</code>. So we need a custom Morphia-converter to map BigDecimals back and forth.</p>
<p>Ok, our application needs some articles or products which we can order. So, lets start with defining the product:
    we save the <code>Product</code>-class in <code>.../jmm/business/product/entity/Product.java</code></p>
<pre><code class="language-java"><span class="hljs-annotation">@Entity</span>(value = <span class="hljs-string">"products"</span>, noClassnameStored = <span
        class="hljs-keyword">true</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span
            class="hljs-title">Product</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">PersistentEntity</span> </span>{

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span
            class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = -<span
            class="hljs-number">7245514305118509921L</span>;

    <span class="hljs-keyword">private</span> String productNo;

    <span class="hljs-keyword">private</span> String description;

    <span class="hljs-keyword">private</span> BigDecimal price;

    <span class="hljs-annotation">@org</span>.mongodb.morphia.annotations.Transient
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> selected;


    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Product</span><span
            class="hljs-params">()</span> </span>{
    }


    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span
            class="hljs-title">getSummary</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.productNo + <span
            class="hljs-string">", "</span> + <span class="hljs-keyword">this</span>.getDescription() + <span
            class="hljs-string">", "</span> + <span class="hljs-keyword">this</span>.getPrice().toString();
    }

    <span class="hljs-comment">// getter/setter/equals()/hashCode()</span>
</code></pre>
<p>Everything cristal clear and not really new stuff, isnt it? There is only this <code>@Transient</code>-annotation.
    It is the
    same behaviour like in JPA, that this property is not mapped and persisted into the database. And if the
    entity is read from database, a transient property contains always the default value for the corresponding data
    type.</p>
<p>For simplicity, we initialize the products programmatically, if they do not already exists. Therefore, we write a
    simple factory, which creates some products on startup <code>.../jmm/business/product/controller/ProductStartupFactory.java</code>:
</p>
<pre><code class="language-java"><span class="hljs-annotation">@Startup</span>
<span class="hljs-annotation">@DependsOn</span>(<span class="hljs-string">"DBConnection"</span>)
<span class="hljs-annotation">@Singleton</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span
            class="hljs-title">ProductStartupFactory</span> </span>{

    <span class="hljs-annotation">@Inject</span>
    Datastore datastore;

    <span class="hljs-annotation">@PostConstruct</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span
            class="hljs-title">init</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span> (datastore.find(Product.class).countAll() == <span
            class="hljs-number">0</span>) {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span
            class="hljs-number">1</span>; i &lt; <span class="hljs-number">12</span>; i++) {
                Product product = <span class="hljs-keyword">new</span> Product();
                product.setProductNo(Integer.toString(i));
                product.setDescription(<span class="hljs-string">"Description of article with no. "</span> + i);
                product.setPrice(<span class="hljs-keyword">new</span> BigDecimal(i));
                datastore.save(product);
            }
        }
    }
}
</code></pre>
<p>Now, at every startup, the application looks, if there are products in the database and if not, some products are
    created, otherwise nothing is done.</p>
<p>Before we can buy some products, we need to define the current user. In a real application, this is done via
    login and then there is one current user in the session. In our case, we will simplify things a bit and select
    the current user from our users list via a button. Therefore, in <code>users.xhtml</code>, we extend our
    <code>h1</code>-tag with</p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-title">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">h:outputText</span> <span
            class="hljs-attribute">value</span>=<span class="hljs-value">"Users"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">h:panelGroup</span> <span class="hljs-attribute">id</span>=<span
            class="hljs-value">"userLabel"</span> <span class="hljs-attribute">style</span>=<span class="hljs-value">"display: inline"</span> <span
            class="hljs-attribute">rendered</span>=<span
            class="hljs-value">"#{not (currentSelectedUser eq null)}"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">h:outputText</span> <span
                class="hljs-attribute">value</span>=<span
                class="hljs-value">" (#{currentSelectedUser.getFullName()})"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">h:panelGroup</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>
</code></pre>
<p>In addition, we put a new column to our users-table so select one user as the current user of our order-session:</p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-title">h:column</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">f:facet</span> <span class="hljs-attribute">name</span>=<span
            class="hljs-value">"header"</span>&gt;</span>
        Select for orders
    <span class="hljs-tag">&lt;/<span class="hljs-title">f:facet</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">h:commandButton</span> <span class="hljs-attribute">value</span>=<span
            class="hljs-value">"select"</span>
                     <span class="hljs-attribute">actionListener</span>=<span class="hljs-value">"#{userController.setCurrentSelectedUser(user)}"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">f:ajax</span> <span
                class="hljs-attribute">execute</span>=<span class="hljs-value">"@this"</span> <span
                class="hljs-attribute">render</span>=<span class="hljs-value">"userLabel"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">h:commandButton</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">h:column</span>&gt;</span>
</code></pre>
<p>And finally, at the bottom of the users-page, we need a link to our order-page (which we will implement in a
    moment):</p>
<pre><code class="language-xml">    ...
        <span class="hljs-tag">&lt;<span class="hljs-title">h:panelGroup</span> <span
                class="hljs-attribute">layout</span>=<span class="hljs-value">"block"</span> <span
                class="hljs-attribute">style</span>=<span class="hljs-value">"margin-top: 20px;"</span>
                      <span class="hljs-attribute">rendered</span>=<span class="hljs-value">"#{not (currentSelectedUser eq null)}"</span> &gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">h:link</span> <span
                    class="hljs-attribute">outcome</span>=<span class="hljs-value">"orders"</span> <span
                    class="hljs-attribute">value</span>=<span class="hljs-value">"Goto orders"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">h:panelGroup</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">f:view</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span>
</code></pre>
<p>Ok, thats all for the users-page. To make this compilable, we had to extend the <code>UserController</code>.
    First, we need a
    property for the current selected user and the corresponding get/set-methods:</p>
<pre><code class="language-java">    <span class="hljs-keyword">private</span> User currentSelectedUser;

    ...

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span
            class="hljs-title">setCurrentSelectedUser</span><span class="hljs-params">(User currentSelectedUser)</span> </span>{
        <span class="hljs-keyword">this</span>.currentSelectedUser = currentSelectedUser;
    }

    <span class="hljs-annotation">@Produces</span> <span class="hljs-annotation">@de</span>.sofiworx.examples.jmm.platform.cdi.Current
    <span class="hljs-annotation">@Named</span>
    <span class="hljs-annotation">@javax</span>.enterprise.context.<span class="hljs-function">Dependent
    <span class="hljs-keyword">public</span> User <span class="hljs-title">getCurrentSelectedUser</span><span
                class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> currentSelectedUser;
    }
</code></pre>
<p>The interesting part here are the annotations at the <code>getCurrentSelectedUser()</code> method. In order to inject
    and use the
    current selected user, we annotate it with <code>@Produces</code> and <code>@Named</code>, so we can use it in our
    JSF-page as well. But
    we have already a method, which produces a <code>User</code>-object (via the <code>getUserToAdd()</code>-method), so
    we have to add a
    qualifier annotation to distinguish between the both methods. The qualifier annotation is simply defined:</p>
<pre><code class="language-java"><span class="hljs-annotation">@Qualifier</span>
<span class="hljs-annotation">@Retention</span>(RetentionPolicy.RUNTIME)
<span class="hljs-annotation">@Target</span>({ElementType.TYPE, ElementType.METHOD, ElementType.FIELD, ElementType.PARAMETER})
<span class="hljs-keyword">public</span> <span class="hljs-annotation">@interface</span> Current {}
</code></pre>
<p>Now we can set the current user of our session via the button in the users-table. After selecting an user, the
    full name of this selected user is displayed at the top of the users-page and the link to the orders-page is
    displayed.</p>
<p>Next, we need a controller for the products <code>.../jmm/business/product/controller/ProductController.java</code>:
</p>
<pre><code class="language-java"><span class="hljs-annotation">@ViewScoped</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span
            class="hljs-title">ProductController</span> <span class="hljs-keyword">implements</span> <span
            class="hljs-title">Serializable</span> </span>{

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span
            class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = -<span
            class="hljs-number">4166516355114826188L</span>;

    <span class="hljs-annotation">@Inject</span>
    Datastore datastore;

    <span class="hljs-annotation">@Produces</span>
    <span class="hljs-annotation">@Named</span>
    <span class="hljs-keyword">private</span> List&lt;Product&gt; allAvailableProducts;


    <span class="hljs-function"><span class="hljs-keyword">public</span> <span
            class="hljs-title">ProductController</span><span class="hljs-params">()</span> </span>{
    }


    <span class="hljs-annotation">@PostConstruct</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span
            class="hljs-title">init</span><span class="hljs-params">()</span> </span>{
        allAvailableProducts = datastore.find(Product.class).asList();
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Product&gt; <span class="hljs-title">getAllAvailableProducts</span><span
            class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> allAvailableProducts;
    }
}
</code></pre>
<p>Finally, we will have a problem, when we persist a property with type <code>BigDecimal</code>. For example, if we
    store a
    <code>BigDecimal</code> with value 4.01, this property is persisted in MongoDB as:</p>
<pre><code class="language-json">"bigDecimalValue": {
    "scale": 2,
    "precision": 3,
    "intCompact": NumberLong(401)
  },
</code></pre>
<p>But if we read such an entity withthis <code>BigDecimal</code> property via Morphia from MongoDB, we will get a
    RuntimeException:</p>
<pre><code class="language-java">java.lang.RuntimeException: org.mongodb.morphia.mapping.MappingException:
   No usable constructor <span class="hljs-keyword">for</span> java.math.BigDecimal
</code></pre>
<p>Morphia cannot instantiate a <code>BigDecimal</code> and set the stored values back, because <code>BigDecimal</code>
    has no
    default constructor. But Morphia provides an easy way to overcome this situation with custom converters.
    There are only two methods, which you have to override, and we decide to use the String-representation of the
    <code>BigDecimal</code> for storing its value in Mongo. Such a custom converter can look like this:</p>
<pre><code class="language-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span
        class="hljs-keyword">class</span> <span class="hljs-title">BigDecimalConverter</span> <span
        class="hljs-keyword">extends</span> <span class="hljs-title">org</span>.<span class="hljs-title">mongodb</span>.<span
        class="hljs-title">morphia</span>.<span class="hljs-title">converters</span>.<span class="hljs-title">TypeConverter</span>
                                 <span class="hljs-keyword">implements</span> <span class="hljs-title">org</span>.<span
            class="hljs-title">mongodb</span>.<span class="hljs-title">morphia</span>.<span class="hljs-title">converters</span>.<span
            class="hljs-title">SimpleValueConverter</span> </span>{

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span
            class="hljs-title">BigDecimalConverter</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">super</span>(BigDecimal.class);
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span
            class="hljs-title">encode</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Object value, <span
            class="hljs-keyword">final</span> MappedField optionalExtraInfo)</span> </span>{
        <span class="hljs-keyword">if</span> (value == <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
        }
        <span class="hljs-keyword">return</span> value.toString();
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span
            class="hljs-title">decode</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Class targetClass, <span
            class="hljs-keyword">final</span> Object fromDBObject,
                         <span class="hljs-keyword">final</span> MappedField optionalExtraInfo)</span> <span
            class="hljs-keyword">throws</span> MappingException </span>{
        <span class="hljs-keyword">if</span> (fromDBObject == <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BigDecimal(fromDBObject.toString());
    }
}
</code></pre>
<p>Of course, the custom converters must be registered for Morphia. We do this in our <code>DBConnection.init()</code>-method:
</p>
<pre><code class="language-java">morphia.getMapper().getConverters().addConverter(BigDecimalConverter.class);
</code></pre>
<h3><a id="Orderpage_1356"></a>Order-page</h3>
<p>In order to make our link to the order page work, we have to implement the <code>orders.xhtml</code>-page.
    On this page, we want to display the recent orders of the current user. Furthermore, we display all available
    products
    in a table, which can be selected via checkbox. And of course, we need a button to submit the order, so the user
    can order his selected products.
    After an order is submitted, the order is displayed in the top table for the current user.</p>
<pre><code class="language-xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-doctype">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">html</span> <span class="hljs-attribute">xmlns</span>=<span
        class="hljs-value">"http://www.w3.org/1999/xhtml"</span>
      <span class="hljs-attribute">xmlns:h</span>=<span class="hljs-value">"http://xmlns.jcp.org/jsf/html"</span>
      <span class="hljs-attribute">xmlns:f</span>=<span class="hljs-value">"http://xmlns.jcp.org/jsf/core"</span>
      <span class="hljs-attribute">xmlns:ui</span>=<span class="hljs-value">"http://xmlns.jcp.org/jsf/facelets"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">f:view</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">h1</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">h:outputText</span> <span
                    class="hljs-attribute">value</span>=<span class="hljs-value">"Orders"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">h:panelGroup</span> <span
                    class="hljs-attribute">id</span>=<span class="hljs-value">"userLabel"</span> <span
                    class="hljs-attribute">style</span>=<span class="hljs-value">"display: inline"</span>
                          <span class="hljs-attribute">rendered</span>=<span class="hljs-value">"#{not (currentSelectedUser eq null)}"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">h:outputText</span> <span class="hljs-attribute">value</span>=<span
                        class="hljs-value">" (#{currentSelectedUser.getFullName()})"</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">h:panelGroup</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">h:panelGroup</span> <span
                class="hljs-attribute">layout</span>=<span class="hljs-value">"block"</span> <span
                class="hljs-attribute">style</span>=<span class="hljs-value">"margin-top: 20px;"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">h:dataTable</span> <span
                    class="hljs-attribute">value</span>=<span
                    class="hljs-value">"#{allOrdersOfCurrentUser}"</span> <span class="hljs-attribute">var</span>=<span
                    class="hljs-value">"order"</span>
                         <span class="hljs-attribute">style</span>=<span class="hljs-value">"border: 1px solid;"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">h:column</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">f:facet</span> <span
                            class="hljs-attribute">name</span>=<span class="hljs-value">"header"</span>&gt;</span>
                        Order date
                    <span class="hljs-tag">&lt;/<span class="hljs-title">f:facet</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">h:outputText</span> <span
                            class="hljs-attribute">value</span>=<span class="hljs-value">"#{order.orderDate}"</span> /&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">h:column</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">h:column</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">f:facet</span> <span
                            class="hljs-attribute">name</span>=<span class="hljs-value">"header"</span>&gt;</span>
                        Total amount
                    <span class="hljs-tag">&lt;/<span class="hljs-title">f:facet</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">h:outputText</span> <span
                            class="hljs-attribute">value</span>=<span class="hljs-value">"#{order.totalAmount}"</span> /&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">h:column</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">h:column</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">f:facet</span> <span
                            class="hljs-attribute">name</span>=<span class="hljs-value">"header"</span>&gt;</span>
                        Ordered products
                    <span class="hljs-tag">&lt;/<span class="hljs-title">f:facet</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">h:panelGroup</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-title">ul</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-title">ui:repeat</span> <span
                                    class="hljs-attribute">value</span>=<span class="hljs-value">"#{order.orderedProducts}"</span> <span
                                    class="hljs-attribute">var</span>=<span
                                    class="hljs-value">"product"</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-title">h:outputText</span> <span
                                        class="hljs-attribute">value</span>=<span class="hljs-value">"#{product.getSummary()}"</span> /&gt;</span>
                            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
                            <span class="hljs-tag">&lt;/<span class="hljs-title">ui:repeat</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-title">h:panelGroup</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">h:column</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">h:dataTable</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">h:panelGroup</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">h:panelGroup</span> <span
                class="hljs-attribute">layout</span>=<span class="hljs-value">"block"</span> <span
                class="hljs-attribute">style</span>=<span class="hljs-value">"margin-top: 20px;"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">h:form</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">h:dataTable</span> <span class="hljs-attribute">value</span>=<span
                        class="hljs-value">"#{allAvailableProducts}"</span> <span
                        class="hljs-attribute">var</span>=<span class="hljs-value">"product"</span>
                             <span class="hljs-attribute">style</span>=<span
                            class="hljs-value">"border: 1px solid;"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">h:column</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-title">f:facet</span> <span class="hljs-attribute">name</span>=<span
                                class="hljs-value">"header"</span>&gt;</span>
                            Product No.
                        <span class="hljs-tag">&lt;/<span class="hljs-title">f:facet</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-title">h:outputText</span> <span
                                class="hljs-attribute">value</span>=<span
                                class="hljs-value">"#{product.productNo}"</span> /&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-title">h:column</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">h:column</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-title">f:facet</span> <span class="hljs-attribute">name</span>=<span
                                class="hljs-value">"header"</span>&gt;</span>
                            Description
                        <span class="hljs-tag">&lt;/<span class="hljs-title">f:facet</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-title">h:outputText</span> <span
                                class="hljs-attribute">value</span>=<span
                                class="hljs-value">"#{product.description}"</span> /&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-title">h:column</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">h:column</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-title">f:facet</span> <span class="hljs-attribute">name</span>=<span
                                class="hljs-value">"header"</span>&gt;</span>
                            Price
                        <span class="hljs-tag">&lt;/<span class="hljs-title">f:facet</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-title">h:outputText</span> <span
                                class="hljs-attribute">value</span>=<span class="hljs-value">"#{product.price}"</span> &gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-title">f:convertNumber</span> <span
                                    class="hljs-attribute">maxFractionDigits</span>=<span class="hljs-value">"2"</span> <span
                                    class="hljs-attribute">minFractionDigits</span>=<span class="hljs-value">"2"</span>
                                             <span class="hljs-attribute">locale</span>=<span
                                        class="hljs-value">"en-US"</span> /&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-title">h:outputText</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-title">h:column</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">h:column</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-title">h:selectBooleanCheckbox</span> <span
                                class="hljs-attribute">value</span>=<span
                                class="hljs-value">"#{product.selected}"</span> /&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-title">h:column</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">h:dataTable</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">h:commandButton</span> <span class="hljs-attribute">value</span>=<span
                        class="hljs-value">"Submit order"</span>
                                 <span class="hljs-attribute">action</span>=<span class="hljs-value">"#{orderController.placeOrder}"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">f:ajax</span> <span class="hljs-attribute">render</span>=<span
                            class="hljs-value">"@all"</span> <span class="hljs-attribute">execute</span>=<span
                            class="hljs-value">"@form"</span> /&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">h:commandButton</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">h:form</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">h:panelGroup</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">h:panelGroup</span> <span
                class="hljs-attribute">layout</span>=<span class="hljs-value">"block"</span> <span
                class="hljs-attribute">style</span>=<span class="hljs-value">"margin-top: 20px;"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">h:link</span> <span class="hljs-attribute">value</span>=<span
                    class="hljs-value">"Back to users"</span> <span class="hljs-attribute">outcome</span>=<span
                    class="hljs-value">"users"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">h:panelGroup</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">f:view</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span>
</code></pre>
<p>Ok, the page was easy, now we need to implement the business logic. First, we start with the <code>Order</code>-class,
    which
    we store in:
    <code>de/sofiworx/examples/jmm/business/order/entity/Order.java</code></p>
<pre><code class="language-java"><span class="hljs-annotation">@Entity</span>(value = <span
        class="hljs-string">"orders"</span>, noClassnameStored = <span class="hljs-keyword">true</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span
            class="hljs-title">Order</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">PersistentEntity</span> </span>{

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span
            class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = <span
            class="hljs-number">7958903679851324189L</span>;

    <span class="hljs-keyword">private</span> Date orderDate;

    <span class="hljs-keyword">private</span> BigDecimal totalAmount;

    <span class="hljs-annotation">@org</span>.mongodb.morphia.annotations.Reference
    <span class="hljs-keyword">private</span> User user;

    <span class="hljs-annotation">@org</span>.mongodb.morphia.annotations.Embedded
    <span class="hljs-keyword">private</span> List&lt;Product&gt; orderedProducts;

    <span class="hljs-comment">// getter/setter/equals()/hashCode()</span>
}
</code></pre>
<p>Our <code>Order</code>-object would be very simple and only contains the date of the order, the total amount of all
    ordered
    products, the reference to the user, who placed the order and of course the list of the products. It is important
    here, that we dont store only references to the products but the products as a whole. This is important for the
    business case, that we need the prices and the state of the products to the time, when they are ordered.
    If someone changes the price in the central product-collection, this changes does not affect already placed orders.
</p>
<p>Next, we need the <code>OrderController</code>, which we store in
    <code>de/sofiworx/examples/jmm/business/order/controller/OrderController.java</code>:</p>
<pre><code class="language-java"><span class="hljs-annotation">@ViewScoped</span>
<span class="hljs-annotation">@Named</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span
            class="hljs-title">OrderController</span> <span class="hljs-keyword">implements</span> <span
            class="hljs-title">Serializable</span> </span>{

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span
            class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = <span
            class="hljs-number">3341943397531831252L</span>;

    <span class="hljs-annotation">@Inject</span>
    Datastore datastore;

    <span class="hljs-annotation">@Inject</span> <span class="hljs-annotation">@Current</span>
    User currentSelectedUser;

    <span class="hljs-annotation">@Inject</span>
    ProductController productController;

    <span class="hljs-keyword">private</span> List&lt;Order&gt; allOrdersOfCurrentUser;


    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">OrderController</span><span
            class="hljs-params">()</span> </span>{
    }


    <span class="hljs-annotation">@PostConstruct</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span
            class="hljs-title">init</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">final</span> Query&lt;Order&gt; query = datastore.createQuery(Order.class);
        query.criteria(<span class="hljs-string">"user"</span>).equal(currentSelectedUser);
        allOrdersOfCurrentUser = query.asList();
        productController.getAllAvailableProducts().stream()
                .forEach(p -&gt; p.setSelected(<span class="hljs-keyword">false</span>));
    }


    <span class="hljs-annotation">@Produces</span>
    <span class="hljs-annotation">@Named</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Order&gt; <span class="hljs-title">getAllOrdersOfCurrentUser</span><span
            class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> allOrdersOfCurrentUser;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span
            class="hljs-title">placeOrder</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">final</span> List&lt;Product&gt; selectedProducts =
                productController.getAllAvailableProducts().stream()
                        .filter(Product::isSelected)
                        .collect(Collectors.toList());
        Order order = <span class="hljs-keyword">new</span> Order();
        order.setOrderDate(<span class="hljs-keyword">new</span> Date());
        order.setUser(currentSelectedUser);
        order.setOrderedProducts(selectedProducts);
        Function&lt;Product, BigDecimal&gt; totalMapper = Product::getPrice;
        BigDecimal total = selectedProducts.stream()
                .map(totalMapper).reduce(BigDecimal.ZERO, BigDecimal::add);
        order.setTotalAmount(total);
        datastore.save(order);
        init();
    }

}
</code></pre>
<p>And last but not least, we need the <code>ProductController</code>, which provides access to our products-list. We
    store it in
    <code>de/sofiworx/examples/jmm/business/product/controller/ProductController.java</code>:</p>
<pre><code class="language-java"><span class="hljs-annotation">@ViewScoped</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span
            class="hljs-title">ProductController</span> <span class="hljs-keyword">implements</span> <span
            class="hljs-title">Serializable</span> </span>{

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span
            class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = -<span
            class="hljs-number">4166516355114826188L</span>;

    <span class="hljs-annotation">@Inject</span>
    Datastore datastore;

    <span class="hljs-annotation">@Produces</span>
    <span class="hljs-annotation">@Named</span>
    <span class="hljs-keyword">private</span> List&lt;Product&gt; allAvailableProducts;


    <span class="hljs-function"><span class="hljs-keyword">public</span> <span
            class="hljs-title">ProductController</span><span class="hljs-params">()</span> </span>{
    }


    <span class="hljs-annotation">@PostConstruct</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span
            class="hljs-title">init</span><span class="hljs-params">()</span> </span>{
        allAvailableProducts = datastore.find(Product.class).asList();
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Product&gt; <span class="hljs-title">getAllAvailableProducts</span><span
            class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> allAvailableProducts;
    }
}
</code></pre>
<p>And thats it. You see, MongoDB, JavaEE and Morphia fit together perfectly. With minimal code, we have implemented
    quite some functionality in our Web-application. And we have only touched the surface. MongoDBs big advantage,
    that it is schema-less, comes into play, if you change/extend your business objects. You dont have to update the
    database, just add the property to your business object and nothing more.</p>
<p>I hope, you find this article somewhat helpful and I appreciate every kind of feedback on this. You can reach me
    on <em>developer(at)<a href="http://cech-home.de">cech-home.de</a></em></p>

</body>
</html>